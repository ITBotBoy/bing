{"ast":null,"code":"const moment = require('moment');\n\nexport default ((req, res) => {\n  let {\n    date = 0,\n    count = 0\n  } = req.query,\n      monthData;\n  const {\n    imgArr\n  } = global; //  28\n\n  if (Number(date)) {\n    console.log(date);\n    date = String(date).slice(6);\n    monthData = imgArr.filter(i => String(i.date).includes(date));\n    console.log(monthData.length); //今天距离月初的天数\n    // count=new Date(date.slice(4), date.slice(2), 0).getDate()\n  } else {\n    const now = moment().format('YYYYMM');\n    monthData = imgArr.filter(i => String(i.date).includes(now));\n\n    if (monthData.length < 28) {\n      const last = moment().subtract(1, 'month').format('YYYYMM');\n      const lastMonthData = imgArr.filter(i => String(i.date).includes(last));\n      console.log(imgArr.length, 'lastMonthData');\n      monthData = monthData.concat(lastMonthData);\n    }\n  } // let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\n  // (startIndex < 0) && (startIndex = imgArr.length-1);\n  // [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\n\n\n  res.json({\n    data: monthData.reverse()\n  });\n});","map":{"version":3,"sources":["F:/bing/Bing/pages/api/list.js"],"names":["moment","require","req","res","date","count","query","monthData","imgArr","global","Number","console","log","String","slice","filter","i","includes","length","now","format","last","subtract","lastMonthData","concat","json","data","reverse"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,gBAAe,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC3B,MAAI;AAAEC,IAAAA,IAAI,GAAG,CAAT;AAAWC,IAAAA,KAAK,GAAG;AAAnB,MAAyBH,GAAG,CAACI,KAAjC;AAAA,MAAuCC,SAAvC;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAaC,MAAnB,CAF2B,CAG3B;;AACA,MAAGC,MAAM,CAACN,IAAD,CAAT,EAAgB;AACZO,IAAAA,OAAO,CAACC,GAAR,CAAYR,IAAZ;AACAA,IAAAA,IAAI,GAACS,MAAM,CAACT,IAAD,CAAN,CAAaU,KAAb,CAAmB,CAAnB,CAAL;AACAP,IAAAA,SAAS,GAACC,MAAM,CAACO,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACZ,IAAH,CAAN,CAAea,QAAf,CAAwBb,IAAxB,CAAjB,CAAV;AACAO,IAAAA,OAAO,CAACC,GAAR,CAAYL,SAAS,CAACW,MAAtB,EAJY,CAKZ;AACA;AACH,GAPD,MAOM;AACF,UAAMC,GAAG,GAAGnB,MAAM,GAAGoB,MAAT,CAAgB,QAAhB,CAAZ;AACAb,IAAAA,SAAS,GAACC,MAAM,CAACO,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACZ,IAAH,CAAN,CAAea,QAAf,CAAwBE,GAAxB,CAAjB,CAAV;;AACA,QAAGZ,SAAS,CAACW,MAAV,GAAiB,EAApB,EAAuB;AACnB,YAAMG,IAAI,GAACrB,MAAM,GAAGsB,QAAT,CAAkB,CAAlB,EAAqB,OAArB,EAA8BF,MAA9B,CAAqC,QAArC,CAAX;AACA,YAAMG,aAAa,GAACf,MAAM,CAACO,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACZ,IAAH,CAAN,CAAea,QAAf,CAAwBI,IAAxB,CAAjB,CAApB;AACAV,MAAAA,OAAO,CAACC,GAAR,CAAYJ,MAAM,CAACU,MAAnB,EAA0B,eAA1B;AACAX,MAAAA,SAAS,GAACA,SAAS,CAACiB,MAAV,CAAiBD,aAAjB,CAAV;AACH;AACJ,GApB0B,CAqBzB;AACA;AACA;;;AACFpB,EAAAA,GAAG,CAACsB,IAAJ,CAAS;AACPC,IAAAA,IAAI,EAAEnB,SAAS,CAACoB,OAAV;AADC,GAAT;AAGD,CA3BD","sourcesContent":["const moment = require('moment');\nexport default (req, res) => {\n  let { date = 0,count = 0 } = req.query,monthData;\n  const { imgArr } = global;\n  //  28\n  if(Number(date)){\n      console.log(date)\n      date=String(date).slice(6)\n      monthData=imgArr.filter(i=>String(i.date).includes(date))\n      console.log(monthData.length)\n      //今天距离月初的天数\n      // count=new Date(date.slice(4), date.slice(2), 0).getDate()\n  }else {\n      const now = moment().format('YYYYMM');\n      monthData=imgArr.filter(i=>String(i.date).includes(now))\n      if(monthData.length<28){\n          const last=moment().subtract(1, 'month').format('YYYYMM')\n          const lastMonthData=imgArr.filter(i=>String(i.date).includes(last))\n          console.log(imgArr.length,'lastMonthData')\n          monthData=monthData.concat(lastMonthData)\n      }\n  }\n    // let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\n    // (startIndex < 0) && (startIndex = imgArr.length-1);\n    // [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\n  res.json({\n    data: monthData.reverse(),\n  })\n}\n"]},"metadata":{},"sourceType":"module"}