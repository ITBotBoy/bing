{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { useEffect, useState, useRef } from 'react';\nimport { Modal, Radio, Spin, Select, Button, message } from 'antd';\nimport \"../styles/downDialog.scss\";\nimport download from \"../util/download\";\nimport axios from \"axios\";\nimport throttle from 'lodash/throttle';\nvar Option = Select.Option;\n\nvar DownDialog = function DownDialog(_ref) {\n  var isMobile = _ref.isMobile,\n      visible = _ref.visible,\n      imgInfo = _ref.imgInfo,\n      onHide = _ref.onHide,\n      downloadFun = _ref.downloadFun;\n\n  var _useState = useState('1920x1080'),\n      size = _useState[0],\n      setSize = _useState[1];\n\n  var _useState2 = useState(true),\n      imgLoading = _useState2[0],\n      setImgLoading = _useState2[1];\n\n  var downLink = useRef();\n  var sizeMap = [['1920x1200', '1920x1080', '1366x768', '1280x768', '1024x768'], ['800x600', '800x480', '768x1280', '720x1280', '640x480', '480x800', '400x240', '320x240', '240x320']];\n\n  var updateSize = function updateSize(val) {\n    window.localStorage.setItem('bing_down_size', val);\n    setImgLoading(true);\n    setSize(val);\n  };\n\n  var onClickDown = function onClickDown() {\n    var urlbase = imgInfo.urlbase,\n        date = imgInfo.date;\n    download(\"//cn.bing.com\".concat(urlbase, \"_\").concat(size, \".jpg\"), \"bing_\".concat(date, \"_\").concat(size, \".jpg\"));\n    downloadFun(date);\n    message.info('加入下载！');\n  };\n\n  var throttleOnClickDown = throttle(function () {\n    return onClickDown();\n  }, 3000);\n  useEffect(function () {\n    var size = window.localStorage.getItem('bing_down_size') || '1920x1080';\n\n    if (isMobile) {\n      size = '768x1280';\n    }\n\n    setSize(size);\n  }, [isMobile]);\n  var downImg = useRef();\n  useEffect(function () {\n    if (downImg && downImg.current && downImg.current.complete) {\n      setImgLoading(false);\n    }\n  }, [imgInfo]);\n  return /*#__PURE__*/_jsx(Modal, {\n    visible: visible,\n    onClose: onHide,\n    onCancel: onHide,\n    footer: null,\n    wrapClassName: \"down-dialog mode-\".concat(isMobile && 'mobile'),\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"down-dialog-content\",\n      children: [imgInfo && /*#__PURE__*/_jsxs(\"div\", {\n        children: [/*#__PURE__*/_jsx(Spin, {\n          spinning: imgLoading,\n          children: /*#__PURE__*/_jsx(\"img\", {\n            ref: downImg,\n            onLoad: function onLoad() {\n              return setImgLoading(false);\n            },\n            className: \"down-img\",\n            src: \"//cn.bing.com\".concat(imgInfo.urlbase, \"_\").concat(size, \".jpg\")\n          })\n        }), isMobile ? /*#__PURE__*/_jsx(\"div\", {\n          className: \"select-size-container\",\n          children: /*#__PURE__*/_jsx(Select, {\n            value: size,\n            onChange: function onChange(v) {\n              return updateSize(v);\n            },\n            children: sizeMap.map(function (arr, i) {\n              return arr.map(function (size) {\n                return /*#__PURE__*/_jsx(Option, {\n                  value: size,\n                  children: size\n                }, \"size-\".concat(size));\n              });\n            })\n          })\n        }) : /*#__PURE__*/_jsx(\"div\", {\n          className: \"select-size-container\",\n          children: sizeMap.map(function (arr, i) {\n            return /*#__PURE__*/_jsxs(\"div\", {\n              className: \"size-row\",\n              children: [/*#__PURE__*/_jsx(\"i\", {\n                className: \"iconfont type-icon icon-\".concat(['pc', 'mobile'][i], \" \").concat(arr.indexOf(size) > -1 && 'actived')\n              }), /*#__PURE__*/_jsx(Radio.Group, {\n                value: size,\n                onChange: function onChange(e) {\n                  return updateSize(e.target.value);\n                },\n                children: arr.map(function (size) {\n                  return /*#__PURE__*/_jsx(Radio.Button, {\n                    value: size,\n                    children: size\n                  }, \"\".concat(i, \"-\").concat(size));\n                })\n              })]\n            }, \"size-type-\".concat(i));\n          })\n        }), /*#__PURE__*/_jsxs(Button, {\n          type: \"primary\",\n          className: \"down-icon\",\n          onClick: function onClick() {\n            return throttleOnClickDown();\n          },\n          children: [/*#__PURE__*/_jsx(\"i\", {\n            className: \"iconfont icon-download\"\n          }), isMobile ? '' : '下载']\n        })]\n      }), /*#__PURE__*/_jsx(\"a\", {\n        ref: downLink,\n        href: \"//cn.bing.com\".concat(imgInfo.urlbase, \"_\").concat(size, \".jpg\"),\n        download: \"bing_\".concat(imgInfo.date, \"_\").concat(size, \".jpg\")\n      })]\n    })\n  });\n};\n\nexport default DownDialog;","map":null,"metadata":{},"sourceType":"module"}