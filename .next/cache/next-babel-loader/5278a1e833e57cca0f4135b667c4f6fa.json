{"ast":null,"code":"const jsonfile = require('jsonfile');\n\nconst moment = require('moment');\n\nconst {\n  cloneDeep,\n  debounce\n} = require('lodash');\n\nconst delayFun = debounce(() => {\n  const nowStr = moment().format('YYYY-MM-DD HH:mm:ss');\n  global.sortInfo['nowStr'] = nowStr;\n  jsonfile.writeFileSync('bing_data/sortData.json', global.sortInfo);\n}, 1000 * 60);\nexport default (async (req, res) => {\n  let {\n    k = 0,\n    date\n  } = req.query;\n\n  if (!global.sortInfo) {\n    try {\n      global.sortInfo = await jsonfile.readFileSync('bing_data/sortData.json');\n    } catch (e) {\n      global.sortInfo = {};\n    }\n\n    return res.json({});\n  }\n\n  const sortInfo = global.sortInfo;\n\n  if (date && k) {\n    //延迟一小时执行\n    if (!sortInfo[date]) {\n      sortInfo[date] = {};\n      sortInfo[date][k] = 1;\n    } else {\n      sortInfo[date][k] = (sortInfo[date][k] || 0) + 1;\n    }\n\n    global.sortInfo = sortInfo;\n    delayFun();\n    res.json(sortInfo[date]);\n  } else {\n    res.json(sortInfo);\n  }\n});","map":null,"metadata":{},"sourceType":"module"}