{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { useRouter } from \"next/router\";\nimport { useState, useEffect, useRef } from 'react';\nimport { message, Spin } from \"antd\";\nimport moment from \"moment\";\nimport '../styles/[date].scss';\nimport DownDialog from \"../components/downDialog\";\nimport Error from 'next/error';\nimport axios from \"axios\";\nimport throttle from \"lodash/throttle\";\nimport Head from \"../components/Head\";\nimport processHTML from \"next/dist/next-server/lib/post-process\"; // import axios from \"axios\";\n// import throttle from \"lodash/throttle\";\n\nexport var __N_SSP = true;\nexport default function date(_ref) {\n  var minDate = _ref.minDate,\n      maxDate = _ref.maxDate,\n      _ref$img = _ref.img,\n      img = _ref$img === void 0 ? {} : _ref$img,\n      timeout = _ref.timeout,\n      nextKey = _ref.nextKey;\n  var router = useRouter();\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      updateLoading = _useState[1];\n\n  var _useState2 = useState(true),\n      showBottom = _useState2[0],\n      updateShowBottom = _useState2[1];\n\n  var _useState3 = useState(new Date().valueOf()),\n      now = _useState3[0],\n      updateNow = _useState3[1];\n\n  var _useState4 = useState(false),\n      downDialogVisible = _useState4[0],\n      setDownDialogVisible = _useState4[1];\n\n  var _useState5 = useState(false),\n      isMobile = _useState5[0],\n      setIsMobile = _useState5[1];\n\n  var _useState6 = useState([]),\n      likeList = _useState6[0],\n      setLikeList = _useState6[1];\n\n  var checkMode = function checkMode() {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n    } else {\n      setIsMobile(false);\n    }\n  }; // likeFun\n\n\n  var likeFun = function likeFun(data) {\n    var localLikeList = window.localStorage.getItem('localLikeList');\n\n    if (!likeList.length && localLikeList) {\n      setLikeList(JSON.parse(localLikeList));\n    }\n\n    if (data) {\n      localLikeList = localLikeList ? JSON.parse(localLikeList) : [];\n\n      if (!localLikeList.includes(data)) {\n        axios(\"/api/sort?date=\".concat(data, \"&k=likeCount\")).then(function (res) {\n          if (res.data.likeCount) {\n            localLikeList.push(data);\n            setLikeList(localLikeList);\n            window.localStorage.setItem('localLikeList', JSON.stringify(localLikeList));\n          }\n        });\n      }\n    }\n  };\n\n  var throttleLikeFun = throttle(function (data) {\n    return likeFun(data);\n  }, 1500);\n\n  var downloadFun = function downloadFun(data) {\n    if (data) {\n      axios(\"/api/sort?date=\".concat(data, \"&k=downloadCount\"));\n    }\n  }; // did mount\n\n\n  var loadingImg = useRef();\n  useEffect(function () {\n    likeFun(); // 图片加载完成就取消 loading\n\n    if (loadingImg.current && loadingImg.current.complete) {\n      updateLoading(false);\n    }\n\n    checkMode();\n\n    window.onkeyup = function (_ref2) {\n      var keyCode = _ref2.keyCode;\n\n      switch (keyCode) {\n        case 32:\n          return window.location = \"/random\";\n\n        /*const date = Math.floor(Math.random() * (maxDate-minDate))+minDate;\n        changePosition(date);*/\n\n        case 37:\n        case 39:\n          changePosition({\n            37: 'prev',\n            39: 'next'\n          }[keyCode]);\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    window.onresize = checkMode;\n    setTimeout(function () {\n      !img.next && (img.next = nextKey);\n    }, timeout);\n  }, []); // 前后切换\n\n  var changePosition = function changePosition(key) {\n    if (!img[key]) {\n      return message.warning({\n        prev: '没有更早的辣！',\n        next: '已经是最新的辣！'\n      }[key]);\n    }\n\n    updateLoading(true);\n    window.location = \"/\".concat(img[key]);\n  }; // 移动鼠标，显示底下区域\n\n\n  var onMouseMove = function onMouseMove() {\n    updateShowBottom(true);\n    updateNow(new Date().valueOf());\n  };\n\n  useEffect(function () {\n    var tick = setTimeout(function () {\n      return updateShowBottom(false);\n    }, 3500);\n    return function () {\n      clearTimeout(tick);\n    };\n  }, [now]);\n  var imgDate = moment(String(img.date), 'YYYYMMDD');\n  return img.date ? /*#__PURE__*/_jsxs(Spin, {\n    spinning: loading,\n    size: \"large\",\n    children: [/*#__PURE__*/_jsx(Head, {}), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"detail-page \".concat(isMobile && 'mobile-mode'),\n      onMouseMove: onMouseMove,\n      children: [/*#__PURE__*/_jsx(\"img\", {\n        className: \"loading-img\",\n        ref: loadingImg,\n        src: \"//cn.bing.com\".concat(img.urlbase, \"_\").concat(isMobile ? '768x1280' : '1920x1080', \".jpg\"),\n        onLoad: function onLoad() {\n          return updateLoading(false);\n        }\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"img-content-box\",\n        style: {\n          backgroundImage: \"url(//cn.bing.com\".concat(img.urlbase, \"_\").concat(isMobile ? '768x1280' : '1920x1080', \".jpg)\")\n        },\n        children: [[{\n          key: 'prev',\n          arrow: 'left'\n        }, {\n          key: 'next',\n          arrow: 'right'\n        }].map(function (_ref3) {\n          var key = _ref3.key,\n              arrow = _ref3.arrow;\n          return img[key] ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"page-icon icon-\".concat(arrow, \" \").concat((showBottom || isMobile) && 'actived'),\n            onClick: function onClick() {\n              return changePosition(key);\n            },\n            children: /*#__PURE__*/_jsx(\"i\", {\n              className: \"iconfont icon-arrow-\".concat(arrow)\n            })\n          }, \"page-\".concat(arrow)) : '';\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"img-info\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"img-date\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"img-date-year\",\n              children: imgDate.format('YY')\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"img-date-md\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                children: imgDate.format('MM')\n              }), /*#__PURE__*/_jsx(\"div\", {\n                children: imgDate.format('DD')\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"img-cp\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"img-cp-txt\",\n              children: img.cp\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"bottom-info \".concat(showBottom && 'actived'),\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"icon-list\",\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              href: \"/\",\n              className: \"iconfont icon-bing\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: (likeList.includes(img.date) ? 'icon-like-fill' : 'icon-xihuan') + ' iconfont',\n              onClick: function onClick() {\n                return throttleLikeFun(img.date);\n              }\n            }), \")\", /*#__PURE__*/_jsx(\"div\", {\n              className: \"iconfont icon-download\",\n              onClick: function onClick() {\n                return setDownDialogVisible(true);\n              }\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"/random\",\n              className: \"iconfont icon-touzi\"\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"/about\",\n              className: \"iconfont icon-about\"\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"https://github.com/renserve/bing\",\n              rel: \"external nofollow noopener noreferrer\",\n              target: \"_blank\",\n              className: \"iconfont icon-github\"\n            })]\n          })\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(DownDialog, {\n      downloadFun: downloadFun,\n      isMobile: isMobile,\n      visible: downDialogVisible,\n      onHide: function onHide() {\n        return setDownDialogVisible(false);\n      },\n      imgInfo: img\n    })]\n  }) : /*#__PURE__*/_jsx(Error, {\n    statusCode: 404\n  });\n}","map":null,"metadata":{},"sourceType":"module"}