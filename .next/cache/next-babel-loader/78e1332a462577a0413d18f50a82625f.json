{"ast":null,"code":"const moment = require('moment');\n\nexport default ((req, res) => {\n  let {\n    date = 0,\n    count = 0\n  } = req.query,\n      monthData;\n  const {\n    imgArr\n  } = global; //  28\n\n  if (date) {\n    date = String(date).slice(6);\n    monthData = imgArr.filter(i => String(i.date).includes(date)); //今天距离月初的天数\n    // count=new Date(date.slice(4), date.slice(2), 0).getDate()\n  } else {\n    const now = moment().format('YYYYMM');\n    monthData = imgArr.filter(i => String(i.date).includes(now));\n\n    if (monthData.length < 28) {\n      const last = moment().subtract(1, 'month').format('YYYYMM');\n      const lastMonthData = imgArr.filter(i => String(i.date).includes(last));\n      monthData = monthData.concat(lastMonthData);\n    }\n  } // let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\n  // (startIndex < 0) && (startIndex = imgArr.length-1);\n  // [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\n\n\n  res.json({\n    data: monthData\n  });\n});","map":{"version":3,"sources":["F:/bing/Bing/pages/api/list.js"],"names":["moment","require","req","res","date","count","query","monthData","imgArr","global","String","slice","filter","i","includes","now","format","length","last","subtract","lastMonthData","concat","json","data"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,gBAAe,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC3B,MAAI;AAAEC,IAAAA,IAAI,GAAG,CAAT;AAAWC,IAAAA,KAAK,GAAG;AAAnB,MAAyBH,GAAG,CAACI,KAAjC;AAAA,MAAuCC,SAAvC;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAaC,MAAnB,CAF2B,CAG3B;;AACA,MAAGL,IAAH,EAAQ;AACJA,IAAAA,IAAI,GAACM,MAAM,CAACN,IAAD,CAAN,CAAaO,KAAb,CAAmB,CAAnB,CAAL;AACAJ,IAAAA,SAAS,GAACC,MAAM,CAACI,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACT,IAAH,CAAN,CAAeU,QAAf,CAAwBV,IAAxB,CAAjB,CAAV,CAFI,CAGJ;AACA;AACH,GALD,MAKM;AACF,UAAMW,GAAG,GAAGf,MAAM,GAAGgB,MAAT,CAAgB,QAAhB,CAAZ;AACAT,IAAAA,SAAS,GAACC,MAAM,CAACI,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACT,IAAH,CAAN,CAAeU,QAAf,CAAwBC,GAAxB,CAAjB,CAAV;;AACA,QAAGR,SAAS,CAACU,MAAV,GAAiB,EAApB,EAAuB;AACnB,YAAMC,IAAI,GAAClB,MAAM,GAAGmB,QAAT,CAAkB,CAAlB,EAAqB,OAArB,EAA8BH,MAA9B,CAAqC,QAArC,CAAX;AACA,YAAMI,aAAa,GAACZ,MAAM,CAACI,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACT,IAAH,CAAN,CAAeU,QAAf,CAAwBI,IAAxB,CAAjB,CAApB;AACAX,MAAAA,SAAS,GAACA,SAAS,CAACc,MAAV,CAAiBD,aAAjB,CAAV;AACH;AACJ,GAjB0B,CAkBzB;AACA;AACA;;;AACFjB,EAAAA,GAAG,CAACmB,IAAJ,CAAS;AACPC,IAAAA,IAAI,EAAEhB;AADC,GAAT;AAGD,CAxBD","sourcesContent":["const moment = require('moment');\nexport default (req, res) => {\n  let { date = 0,count = 0 } = req.query,monthData;\n  const { imgArr } = global;\n  //  28\n  if(date){\n      date=String(date).slice(6)\n      monthData=imgArr.filter(i=>String(i.date).includes(date))\n      //今天距离月初的天数\n      // count=new Date(date.slice(4), date.slice(2), 0).getDate()\n  }else {\n      const now = moment().format('YYYYMM');\n      monthData=imgArr.filter(i=>String(i.date).includes(now))\n      if(monthData.length<28){\n          const last=moment().subtract(1, 'month').format('YYYYMM')\n          const lastMonthData=imgArr.filter(i=>String(i.date).includes(last))\n          monthData=monthData.concat(lastMonthData)\n      }\n  }\n    // let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\n    // (startIndex < 0) && (startIndex = imgArr.length-1);\n    // [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\n  res.json({\n    data: monthData,\n  })\n}\n"]},"metadata":{},"sourceType":"module"}