{"ast":null,"code":"const jsonfile = require('jsonfile');\n\nconst moment = require('moment');\n\nlet delayFun;\nexport default (async (req, res) => {\n  let {\n    k = 0,\n    date\n  } = req.query;\n  let sortInfo = global.sortInfo;\n\n  if (!sortInfo) {\n    sortInfo = await jsonfile.readFile('bing_data/sortData.json').catch(() => ({}));\n  }\n\n  if (date && k) {\n    //延迟一小时执行\n    if (!sortInfo[date]) {\n      sortInfo[date] = {};\n      sortInfo[date][k] = 1;\n    } else {\n      sortInfo[date][k] = (sortInfo[date][k] || 0) + 1;\n    }\n\n    delayFun && clearTimeout(delayFun);\n    delayFun = setTimeout(() => {\n      delayFun = null;\n      const nowStr = moment().format('YYYY-MM-DD HH:mm:ss');\n      sortInfo['nowStr'] = nowStr;\n      jsonfile.writeFileSync('bing_data/sortData.json', sortInfo);\n    }, 60 * 60 * 1000);\n    global.sortInfo = sortInfo;\n    res.json(sortInfo[date]);\n  } else {\n    res.json(sortInfo);\n  }\n});","map":null,"metadata":{},"sourceType":"module"}