{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport axios from 'axios';\nimport { useState, useEffect, useRef } from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\nexport default function () {\n  var _useState = useState([]),\n      list = _useState[0],\n      updateList = _useState[1];\n\n  var _useState2 = useState(0),\n      nextDate = _useState2[0],\n      updateNextDate = _useState2[1];\n\n  var _useState3 = useState(false),\n      loading = _useState3[0],\n      updateLoading = _useState3[1];\n\n  var _useState4 = useState(false),\n      isMobile = _useState4[0],\n      setIsMobile = _useState4[1];\n\n  var _useState5 = useState(false),\n      showTop = _useState5[0],\n      setShowTop = _useState5[1];\n\n  var _useState6 = useState(false),\n      isEmpty = _useState6[0],\n      setEmpty = _useState6[1];\n\n  var checkMode = function checkMode() {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n      return true;\n    }\n\n    setIsMobile(false);\n    return false;\n  };\n\n  var queryList = function queryList(nextDate, isMobile) {\n    updateLoading(true);\n    axios(\"/api/list?date=\".concat(nextDate, \"&count=10\")).then(function (_ref) {\n      var data = _ref.data;\n      var count = 0;\n      var maxCount = isMobile ? 0 : 2;\n      data.data.forEach(function (item, i) {\n        var span = 1;\n        count < maxCount && maxCount && (span = Math.ceil(Math.random() * 2));\n        maxCount - count === 10 - i && maxCount && (span = 2);\n        console.log(maxCount, span, isMobile);\n        span === 2 && (count += 1);\n        item.style = {\n          gridColumnStart: \"span \".concat(span),\n          gridRowStart: \"span \".concat(span)\n        };\n        item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n        item.span = span;\n      });\n      var last = data.data.last();\n      updateList([].concat(_toConsumableArray(list), _toConsumableArray(data.data)));\n      !last.prev && setEmpty(true);\n      updateNextDate(last.prev);\n      updateLoading(false);\n    });\n  };\n\n  var $page = useRef();\n  useEffect(function (e) {\n    window.onscroll = function () {\n      if (loading || isEmpty) {\n        return;\n      }\n\n      setShowTop(document.documentElement.scrollTop > 700);\n\n      if (document.documentElement.clientHeight + document.documentElement.scrollTop + 50 > $page.current.clientHeight) {\n        queryList(nextDate, isMobile);\n      }\n    };\n\n    setTimeout(function () {\n      window.onscroll();\n    });\n  }, [nextDate, loading]);\n  useEffect(function () {\n    var isMobile = checkMode();\n\n    Array.prototype.last = function () {\n      return this[this.length - 1];\n    };\n\n    queryList(nextDate, isMobile);\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"index-page \".concat(isMobile && 'mobile-page'),\n    ref: $page,\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      id: \"head\"\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"img-list\",\n      style: {\n        gridTemplateRows: isMobile ? \"repeat(\".concat(list.length, \", 75vw)\") : \"repeat(\".concat(Math.ceil(list.length / 10) * 4, \", 19vw)\")\n      },\n      children: list.map(function (img) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          className: \"img-item\",\n          style: img.style,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"cover\",\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              className: \"iconfont icon-eye\",\n              href: \"/\".concat(img.date)\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"text\",\n              children: img.cp\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"date-str size-\".concat(img.span),\n            children: img.dateStr\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"img-bg\",\n            style: {\n              backgroundImage: \"url('//cn.bing.com\".concat(img.urlbase, \"_\").concat(false ? '768x1280' : '1024x768', \".jpg')\")\n            }\n          })]\n        }, img.date);\n      })\n    }), isEmpty && /*#__PURE__*/_jsx(\"div\", {\n      className: \"empty-text\",\n      children: \"\\u2014\\u2014 \\u5230\\u5E95\\u5566 \\u2014\\u2014\"\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"right-btn\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"to-top iconfont icon-arrow-left \".concat(!showTop && 'hide'),\n        onClick: function onClick() {\n          return window.scrollTo(0, 0);\n        }\n      }), /*#__PURE__*/_jsx(\"a\", {\n        className: \"iconfont icon-touzi\",\n        href: \"/random\"\n      })]\n    })]\n  });\n}","map":{"version":3,"sources":["F:/bing/Bing/pages/index.js"],"names":["axios","useState","useEffect","useRef","moment","list","updateList","nextDate","updateNextDate","loading","updateLoading","isMobile","setIsMobile","showTop","setShowTop","isEmpty","setEmpty","checkMode","window","innerWidth","innerHeight","queryList","then","data","count","maxCount","forEach","item","i","span","Math","ceil","random","console","log","style","gridColumnStart","gridRowStart","dateStr","date","format","last","prev","$page","e","onscroll","document","documentElement","scrollTop","clientHeight","current","setTimeout","Array","prototype","length","gridTemplateRows","map","img","cp","backgroundImage","urlbase","scrollTo"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { useState, useEffect, useRef } from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\n\nexport default function () {\n\n  const [list, updateList] = useState([]);\n  const [nextDate, updateNextDate] = useState(0);\n  const [loading, updateLoading] = useState(false);\n  const [isMobile, setIsMobile] = useState(false);\n  const [showTop, setShowTop] = useState(false);\n  const [isEmpty, setEmpty] = useState(false);\n\n  const checkMode = () => {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n      return true;\n    }\n    setIsMobile(false)\n    return false;\n  }\n\n  const queryList = (nextDate, isMobile) => {\n    updateLoading(true);\n    axios(`/api/list?date=${nextDate}&count=10`)\n      .then(({ data }) => {\n        let count = 0;\n        const maxCount = isMobile ? 0 : 2;\n        data.data.forEach((item, i) => {\n          let span = 1;\n          (count < maxCount) && maxCount && (span = Math.ceil(Math.random() * 2));\n          ((maxCount-count) === (10 - i)) && maxCount && (span = 2);\n\n          console.log(maxCount, span, isMobile);\n          span === 2 && (count += 1);\n          item.style = {\n            gridColumnStart: `span ${span}`,\n            gridRowStart: `span ${span}`,\n          }\n          item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n          item.span = span;\n        })\n        const last = data.data.last()\n        updateList([ ...list, ...data.data ]);\n        !last.prev && setEmpty(true);\n        updateNextDate(last.prev);\n        updateLoading(false);\n\n      })\n  }\n\n  const $page = useRef();\n\n  useEffect((e) => {\n    window.onscroll = () => {\n      if (loading || isEmpty) {\n        return;\n      }\n      setShowTop(document.documentElement.scrollTop > 700);\n      if (document.documentElement.clientHeight + document.documentElement.scrollTop + 50 > $page.current.clientHeight) {\n        queryList(nextDate, isMobile);\n      }\n    }\n    setTimeout(() => {\n      window.onscroll();\n    })\n  }, [nextDate, loading]);\n\n  useEffect(() => {\n    const isMobile = checkMode();\n    Array.prototype.last = function () {\n      return this[this.length-1];\n    }\n\n    queryList(nextDate, isMobile)\n  }, [])\n\n  return (\n    <div className={`index-page ${isMobile && 'mobile-page'}`} ref={$page}>\n      <div id=\"head\" />\n      <div className=\"img-list\"\n           style={{\n             gridTemplateRows: isMobile ? `repeat(${list.length}, 75vw)` : `repeat(${Math.ceil(list.length/10)*4}, 19vw)`\n           }}>\n        {\n          list.map((img) => (\n            <div\n              className=\"img-item\"\n              style={img.style}\n              key={img.date}\n            >\n              <div className=\"cover\">\n                <a className=\"iconfont icon-eye\" href={`/${img.date}`} />\n                <span className=\"text\">{img.cp}</span>\n              </div>\n              <div className={`date-str size-${img.span}`}>{img.dateStr}</div>\n              <div className=\"img-bg\" style={{backgroundImage: `url('//cn.bing.com${img.urlbase}_${false ? '768x1280' : '1024x768'}.jpg')`}} />\n            </div>\n          ))\n        }\n      </div>\n      {isEmpty && <div className=\"empty-text\">—— 到底啦 ——</div>}\n      <div className=\"right-btn\">\n        <div className={`to-top iconfont icon-arrow-left ${!showTop && 'hide'}`} onClick={() => window.scrollTo(0, 0)} />\n        <a className=\"iconfont icon-touzi\" href='/random' />\n      </div>\n    </div>\n  )\n}"]},"metadata":{},"sourceType":"module"}