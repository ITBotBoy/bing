{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport axios from 'axios';\nimport { useState, useEffect, useRef } from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\nimport Head from \"../components/Head\";\nexport default function () {\n  var _useState = useState([]),\n      list = _useState[0],\n      updateList = _useState[1];\n\n  var _useState2 = useState(0),\n      nextDate = _useState2[0],\n      updateNextDate = _useState2[1];\n\n  var _useState3 = useState(false),\n      loading = _useState3[0],\n      updateLoading = _useState3[1];\n\n  var _useState4 = useState(false),\n      isMobile = _useState4[0],\n      setIsMobile = _useState4[1];\n\n  var _useState5 = useState(false),\n      showTop = _useState5[0],\n      setShowTop = _useState5[1];\n\n  var _useState6 = useState(false),\n      isEmpty = _useState6[0],\n      setEmpty = _useState6[1];\n\n  var checkMode = function checkMode() {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n      return true;\n    }\n\n    setIsMobile(false);\n    return false;\n  };\n\n  var queryList = function queryList(nextDate, isMobile) {\n    updateLoading(true);\n    nextDate = String(nextDate).substr(0, 6);\n    axios(\"/api/list?date=\".concat(nextDate, \"&count=10\")).then(function (_ref) {\n      var data = _ref.data;\n      var count = 0;\n      var maxCount = isMobile ? 0 : 2;\n      data.data.forEach(function (item, i) {\n        var span = 1; //0 1 2\n\n        count < maxCount && maxCount && (span = Math.ceil(Math.random() * 2));\n        maxCount - count === 10 - i && maxCount && (span = 2);\n        console.log(maxCount, span, isMobile);\n        span === 2 && (count += 1);\n        item.style = {\n          gridColumnStart: \"span \".concat(span),\n          gridRowStart: \"span \".concat(span)\n        };\n        item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n        item.span = span;\n      });\n      var last = data.data.last();\n      updateList([].concat(_toConsumableArray(list), _toConsumableArray(data.data)));\n      !last.prev && setEmpty(true);\n      updateNextDate(last.prev);\n      updateLoading(false);\n    });\n  };\n\n  var $page = useRef();\n  useEffect(function (e) {\n    window.onscroll = function () {\n      if (loading || isEmpty) {\n        return;\n      }\n\n      setShowTop(document.documentElement.scrollTop > 700);\n\n      if (document.documentElement.clientHeight + document.documentElement.scrollTop + 50 > $page.current.clientHeight) {\n        queryList(nextDate, isMobile);\n      }\n    };\n\n    setTimeout(function () {\n      window.onscroll();\n    });\n  }, [nextDate, loading]);\n  useEffect(function () {\n    var isMobile = checkMode();\n\n    Array.prototype.last = function () {\n      return this[this.length - 1];\n    };\n\n    queryList(nextDate, isMobile);\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"index-page \".concat(isMobile && 'mobile-page'),\n    ref: $page,\n    children: [/*#__PURE__*/_jsx(Head, {}), /*#__PURE__*/_jsx(\"div\", {\n      className: \"img-list\",\n      style: {\n        gridTemplateRows: isMobile ? \"repeat(\".concat(list.length, \", 75vw)\") : \"repeat(\".concat(Math.ceil(list.length / 10) * 4, \", 19vw)\")\n      },\n      children: list.map(function (img) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          className: \"img-item\",\n          style: img.style,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"cover\",\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              className: \"iconfont icon-fangda actionBtn\",\n              href: \"/\".concat(img.date)\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"text\",\n              children: img.cp\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"date-str size-\".concat(img.span),\n            children: img.dateStr\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"img-bg\",\n            style: {\n              backgroundImage: \"url('//cn.bing.com\".concat(img.urlbase, \"_\").concat(false ? '768x1280' : '1024x768', \".jpg')\")\n            }\n          })]\n        }, img.date);\n      })\n    }), isEmpty && /*#__PURE__*/_jsx(\"div\", {\n      className: \"empty-text\",\n      children: \"\\u2014\\u2014 \\u5230\\u5E95\\u5566 \\u2014\\u2014\"\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"right-btn\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"to-top iconfont icon-arrow-left \".concat(!showTop && 'hide'),\n        onClick: function onClick() {\n          return window.scrollTo(0, 0);\n        }\n      }), /*#__PURE__*/_jsx(\"a\", {\n        className: \"iconfont icon-touzi\",\n        href: \"/random\"\n      })]\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}