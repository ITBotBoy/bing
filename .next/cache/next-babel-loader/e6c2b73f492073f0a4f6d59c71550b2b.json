{"ast":null,"code":"const jsonfile = require('jsonfile');\n\nlet delayFun;\nexport default (async (req, res) => {\n  let {\n    k = 0,\n    date\n  } = req.query;\n  let sortInfo = global.sortInfo;\n\n  if (!sortInfo) {\n    sortInfo = await jsonfile.readFile('bing_data/sortData.json').catch(() => ({}));\n  }\n\n  if (date && k) {\n    //延迟一小时执行\n    if (!sortInfo[date]) {\n      sortInfo[date] = {};\n      sortInfo[date][k] = 1;\n    } else {\n      sortInfo[date][k] = (sortInfo[date][k] || 0) + 1;\n    }\n\n    console.log(sortInfo);\n    delayFun && clearTimeout(delayFun);\n    delayFun = setTimeout(() => {\n      delayFun = null;\n      jsonfile.writeFileSync('bing_data/sortData.json', sortInfo);\n    }, 60 * 60 * 1000);\n    global.sortInfo = sortInfo;\n    res.json(sortInfo[date]);\n  } else {\n    res.json(sortInfo);\n  }\n});","map":{"version":3,"sources":["F:/bing/Bing/pages/api/sort.js"],"names":["jsonfile","require","delayFun","req","res","k","date","query","sortInfo","global","readFile","catch","console","log","clearTimeout","setTimeout","writeFileSync","json"],"mappings":"AAAA,MAAMA,QAAQ,GAAGC,OAAO,CAAC,UAAD,CAAxB;;AACA,IAAIC,QAAJ;AACA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AAC/B,MAAI;AAAEC,IAAAA,CAAC,GAAG,CAAN;AAASC,IAAAA;AAAT,MAAiBH,GAAG,CAACI,KAAzB;AACA,MAAIC,QAAQ,GAAEC,MAAM,CAACD,QAArB;;AACA,MAAG,CAACA,QAAJ,EAAa;AACTA,IAAAA,QAAQ,GAAG,MAAMR,QAAQ,CAACU,QAAT,CAAkB,yBAAlB,EACZC,KADY,CACN,OAAO,EAAP,CADM,CAAjB;AAEH;;AACD,MAAGL,IAAI,IAAID,CAAX,EAAa;AACT;AACA,QAAG,CAACG,QAAQ,CAACF,IAAD,CAAZ,EAAmB;AACfE,MAAAA,QAAQ,CAACF,IAAD,CAAR,GAAe,EAAf;AACAE,MAAAA,QAAQ,CAACF,IAAD,CAAR,CAAeD,CAAf,IAAkB,CAAlB;AACH,KAHD,MAGM;AACFG,MAAAA,QAAQ,CAACF,IAAD,CAAR,CAAeD,CAAf,IAAkB,CAACG,QAAQ,CAACF,IAAD,CAAR,CAAeD,CAAf,KAAqB,CAAtB,IAAyB,CAA3C;AACH;;AACDO,IAAAA,OAAO,CAACC,GAAR,CAAYL,QAAZ;AACAN,IAAAA,QAAQ,IAAIY,YAAY,CAACZ,QAAD,CAAxB;AACAA,IAAAA,QAAQ,GAACa,UAAU,CAAC,MAAI;AACpBb,MAAAA,QAAQ,GAAC,IAAT;AACAF,MAAAA,QAAQ,CAACgB,aAAT,CAAuB,yBAAvB,EAAiDR,QAAjD;AACH,KAHkB,EAGjB,KAAG,EAAH,GAAM,IAHW,CAAnB;AAIAC,IAAAA,MAAM,CAACD,QAAP,GAAgBA,QAAhB;AACAJ,IAAAA,GAAG,CAACa,IAAJ,CAAST,QAAQ,CAACF,IAAD,CAAjB;AACH,GAhBD,MAgBM;AACFF,IAAAA,GAAG,CAACa,IAAJ,CAAST,QAAT;AACH;AACJ,CA1BD","sourcesContent":["const jsonfile = require('jsonfile')\r\nlet delayFun;\r\nexport default async (req, res) => {\r\n    let { k = 0 ,date} = req.query;\r\n    let sortInfo= global.sortInfo\r\n    if(!sortInfo){\r\n        sortInfo = await jsonfile.readFile('bing_data/sortData.json')\r\n            .catch(() => ({}))\r\n    }\r\n    if(date && k){\r\n        //延迟一小时执行\r\n        if(!sortInfo[date]){\r\n            sortInfo[date]={}\r\n            sortInfo[date][k]=1\r\n        }else {\r\n            sortInfo[date][k]=(sortInfo[date][k] || 0)+1\r\n        }\r\n        console.log(sortInfo)\r\n        delayFun && clearTimeout(delayFun);\r\n        delayFun=setTimeout(()=>{\r\n            delayFun=null\r\n            jsonfile.writeFileSync('bing_data/sortData.json',sortInfo)\r\n        },60*60*1000)\r\n        global.sortInfo=sortInfo\r\n        res.json(sortInfo[date])\r\n    }else {\r\n        res.json(sortInfo)\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}