{"ast":null,"code":"const moment = require('moment');\n\nexport default ((req, res) => {\n  let {\n    date = 0,\n    count = 0\n  } = req.query,\n      monthData;\n  const {\n    imgArr\n  } = global; //  28\n\n  /*if(Number(date)){\r\n      console.log(date)\r\n      date=String(date).slice(0,6)\r\n      monthData=imgArr.filter(i=>String(i.date).includes(date))\r\n      //今天距离月初的天数\r\n      // count=new Date(date.slice(4), date.slice(2), 0).getDate()\r\n  }else {\r\n      const now = moment().format('YYYYMM');\r\n      monthData=imgArr.filter(i=>String(i.date).includes(now))\r\n      if(monthData.length<28){\r\n          const last=moment().subtract(1, 'month').format('YYYYMM')\r\n          const lastMonthData=imgArr.filter(i=>String(i.date).includes(last))\r\n          console.log(imgArr.length,'lastMonthData')\r\n          monthData=monthData.concat(lastMonthData)\r\n      }\r\n  }*/\n\n  let startIndex = imgArr.findIndex(({\n    date: d\n  }) => date === `${d}`);\n  startIndex < 0 && (startIndex = imgArr.length - 1);\n  res.json({\n    data: [...imgArr.slice(Math.max(0, startIndex - (count - 1)), startIndex + 1)].reverse()\n  });\n});","map":{"version":3,"sources":["E:/Future/bing/pages/api/list.js"],"names":["moment","require","req","res","date","count","query","monthData","imgArr","global","startIndex","findIndex","d","length","json","data","slice","Math","max","reverse"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,gBAAe,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC3B,MAAI;AAAEC,IAAAA,IAAI,GAAG,CAAT;AAAWC,IAAAA,KAAK,GAAG;AAAnB,MAAyBH,GAAG,CAACI,KAAjC;AAAA,MAAuCC,SAAvC;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAaC,MAAnB,CAF2B,CAG3B;;AACA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACI,MAAIC,UAAU,GAAGF,MAAM,CAACG,SAAP,CAAiB,CAAC;AAAEP,IAAAA,IAAI,EAAEQ;AAAR,GAAD,KAAiBR,IAAI,KAAM,GAAEQ,CAAE,EAAhD,CAAjB;AACCF,EAAAA,UAAU,GAAG,CAAd,KAAqBA,UAAU,GAAGF,MAAM,CAACK,MAAP,GAAc,CAAhD;AAEFV,EAAAA,GAAG,CAACW,IAAJ,CAAS;AACPC,IAAAA,IAAI,EAAE,CAAC,GAAGP,MAAM,CAACQ,KAAP,CAAaC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYR,UAAU,IAAIL,KAAK,GAAC,CAAV,CAAtB,CAAb,EAAkDK,UAAU,GAAG,CAA/D,CAAJ,EAAuES,OAAvE;AADC,GAAT;AAGD,CA1BD","sourcesContent":["const moment = require('moment');\r\nexport default (req, res) => {\r\n  let { date = 0,count = 0 } = req.query,monthData;\r\n  const { imgArr } = global;\r\n  //  28\r\n  /*if(Number(date)){\r\n      console.log(date)\r\n      date=String(date).slice(0,6)\r\n      monthData=imgArr.filter(i=>String(i.date).includes(date))\r\n      //今天距离月初的天数\r\n      // count=new Date(date.slice(4), date.slice(2), 0).getDate()\r\n  }else {\r\n      const now = moment().format('YYYYMM');\r\n      monthData=imgArr.filter(i=>String(i.date).includes(now))\r\n      if(monthData.length<28){\r\n          const last=moment().subtract(1, 'month').format('YYYYMM')\r\n          const lastMonthData=imgArr.filter(i=>String(i.date).includes(last))\r\n          console.log(imgArr.length,'lastMonthData')\r\n          monthData=monthData.concat(lastMonthData)\r\n      }\r\n  }*/\r\n    let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\r\n    (startIndex < 0) && (startIndex = imgArr.length-1);\r\n\r\n  res.json({\r\n    data: [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\r\n  })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}