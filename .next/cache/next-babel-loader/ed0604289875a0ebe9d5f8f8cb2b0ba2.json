{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport axios from 'axios';\nimport { useState, useEffect, useRef } from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\nimport Head from \"../components/Head\";\nimport DownDialog from \"../components/downDialog\";\nimport throttle from 'lodash/throttle';\nimport { Spin } from \"antd\";\n/*export default class Page extends React.Component {\n    componentDidMount () {\n        likeFun()\n    }\n    render (){\n        return PageFun()\n    }\n}*/\n\nexport default function () {\n  const {\n    0: downDialogVisible,\n    1: setDownDialogVisible\n  } = useState(false);\n  const {\n    0: list,\n    1: updateList\n  } = useState([]);\n  const {\n    0: img,\n    1: updateImg\n  } = useState({});\n  const {\n    0: nextDate,\n    1: updateNextDate\n  } = useState(0);\n  const {\n    0: loading,\n    1: updateLoading\n  } = useState(false);\n  const {\n    0: isMobile,\n    1: setIsMobile\n  } = useState(false);\n  const {\n    0: showTop,\n    1: setShowTop\n  } = useState(false);\n  const {\n    0: isEmpty,\n    1: setEmpty\n  } = useState(false);\n  const {\n    0: sortInfo,\n    1: setSortInfo\n  } = useState({});\n  const {\n    0: likeList,\n    1: setLikeList\n  } = useState([]);\n\n  const checkMode = () => {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n      return true;\n    }\n\n    setIsMobile(false);\n    return false;\n  };\n\n  const likeFun = data => {\n    let localLikeList = window.localStorage.getItem('localLikeList');\n\n    if (!likeList.length && localLikeList) {\n      setLikeList(JSON.parse(localLikeList));\n    }\n\n    if (data) {\n      localLikeList = localLikeList ? JSON.parse(localLikeList) : [];\n\n      if (!localLikeList.includes(data)) {\n        axios(`/api/sort?date=${data}&k=likeCount`).then(res => {\n          if (res.data.likeCount) {\n            if (!sortInfo[data]) {\n              sortInfo[data] = {\n                likeCount: 0\n              };\n            }\n\n            sortInfo[data].likeCount = res.data.likeCount;\n            setSortInfo(sortInfo);\n            localLikeList.push(data);\n            setLikeList(localLikeList);\n            window.localStorage.setItem('localLikeList', JSON.stringify(localLikeList));\n          }\n        });\n      }\n    }\n  };\n\n  const throttleLikeFun = throttle(data => likeFun(data), 1500);\n\n  if (false && window) {\n    likeFun();\n  }\n\n  const downloadFun = data => {\n    if (data) {\n      axios(`/api/sort?date=${data}&k=downloadCount`).then(res => {\n        if (res.data.likeCount) {\n          if (!sortInfo[data]) {\n            sortInfo[data] = {\n              downloadCount: 0\n            };\n          }\n\n          sortInfo[data].downloadCount = res.data.downloadCount;\n          setSortInfo(sortInfo);\n        }\n      });\n    }\n  };\n\n  const queryList = (nextDate, isMobile) => {\n    updateLoading(true);\n    axios(`/api/list?date=${nextDate}&count=10`).then(({\n      data\n    }) => {\n      let count = 0;\n      const maxCount = isMobile ? 0 : 2;\n      data.data.forEach((item, i) => {\n        let span = 1; //0 1 2\n\n        count < maxCount && maxCount && (span = Math.ceil(Math.random() * 2)); // 10-i,第8张换span  8 16 24 i &&\n\n        maxCount - count === 10 - i && maxCount && (span = 2);\n        console.log(span, 'span'); // console.log(maxCount, span, isMobile);\n\n        span === 2 && (count += 1);\n        item.style = {\n          gridColumnStart: `span ${span}`,\n          gridRowStart: `span ${span}`\n        };\n        item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n        item.span = span;\n      });\n      const last = data.data.last();\n      updateList([...list, ...data.data]);\n      !last.prev && setEmpty(true);\n      updateNextDate(last.prev);\n      updateLoading(false);\n    });\n  };\n\n  const $page = useRef();\n  useEffect(e => {\n    window.onscroll = () => {\n      if (loading || isEmpty) {\n        return;\n      }\n\n      setShowTop(document.documentElement.scrollTop > 700);\n\n      if (document.documentElement.clientHeight + document.documentElement.scrollTop + 50 > $page.current.clientHeight) {\n        queryList(nextDate, isMobile);\n      }\n    };\n\n    setTimeout(() => {\n      window.onscroll();\n    });\n  }, [nextDate, loading]);\n  useEffect(() => {\n    const isMobile = checkMode();\n\n    Array.prototype.last = function () {\n      return this[this.length - 1];\n    };\n\n    axios(`/api/sort`).then(res => {\n      setSortInfo(res.data);\n    });\n    queryList(nextDate, isMobile);\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: `index-page ${isMobile && 'mobile-page'}`,\n    ref: $page,\n    children: [/*#__PURE__*/_jsx(Head, {}), /*#__PURE__*/_jsx(\"div\", {\n      className: \"img-list\",\n      style: {\n        gridTemplateRows: isMobile ? `repeat(${list.length}, 75vw)` : `repeat(${parseInt(list.length / 10) * 4}, 19vw)`\n      },\n      children: list.map(img => /*#__PURE__*/_jsxs(\"div\", {\n        className: \"img-item\",\n        style: img.style,\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"cover\",\n          children: [/*#__PURE__*/_jsx(\"a\", {\n            className: \"iconfont icon-fangda actionBtn\",\n            href: `/${img.date}`\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"text\",\n            children: img.cp\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: `date-str size-${img.span}`,\n          children: img.dateStr\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"img-bg\",\n          style: {\n            backgroundImage: `url('//cn.bing.com${img.urlbase}_${false ? '768x1280' : '1024x768'}.jpg')`\n          }\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"handleButton\",\n          children: [/*#__PURE__*/_jsx(\"span\", {\n            className: (likeList.includes(img.date) ? 'icon-like-fill' : 'icon-xihuan') + ' iconfont',\n            onClick: () => {\n              throttleLikeFun(img.date);\n            },\n            children: /*#__PURE__*/_jsx(\"span\", {\n              className: \"count\",\n              children: sortInfo[img.date] && sortInfo[img.date].likeCount || 0\n            })\n          }), /*#__PURE__*/_jsx(\"span\", {\n            onClick: () => {\n              setDownDialogVisible(true);\n              updateImg(img);\n            },\n            className: \"iconfont icon-download\",\n            children: /*#__PURE__*/_jsx(\"span\", {\n              className: \"count\",\n              children: sortInfo[img.date] && sortInfo[img.date].downloadCount || 0\n            })\n          })]\n        })]\n      }, img.date))\n    }), isEmpty && /*#__PURE__*/_jsx(\"div\", {\n      className: \"empty-text\",\n      children: \"\\u2014\\u2014 \\u5230\\u5E95\\u5566 \\u2014\\u2014\"\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"right-btn\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: `to-top iconfont icon-arrow-left ${!showTop && 'hide'}`,\n        onClick: () => window.scrollTo(0, 0)\n      }), /*#__PURE__*/_jsx(\"a\", {\n        className: \"iconfont icon-touzi\",\n        href: \"/random\"\n      })]\n    }), /*#__PURE__*/_jsx(DownDialog, {\n      downloadFun: downloadFun,\n      isMobile: isMobile,\n      visible: downDialogVisible,\n      onHide: () => {\n        setDownDialogVisible(false);\n        updateImg({});\n      },\n      imgInfo: img\n    })]\n  });\n}","map":{"version":3,"sources":["F:/bing/Bing/pages/index.js"],"names":["axios","useState","useEffect","useRef","moment","Head","DownDialog","throttle","Spin","downDialogVisible","setDownDialogVisible","list","updateList","img","updateImg","nextDate","updateNextDate","loading","updateLoading","isMobile","setIsMobile","showTop","setShowTop","isEmpty","setEmpty","sortInfo","setSortInfo","likeList","setLikeList","checkMode","window","innerWidth","innerHeight","likeFun","data","localLikeList","localStorage","getItem","length","JSON","parse","includes","then","res","likeCount","push","setItem","stringify","throttleLikeFun","downloadFun","downloadCount","queryList","count","maxCount","forEach","item","i","span","Math","ceil","random","console","log","style","gridColumnStart","gridRowStart","dateStr","date","format","last","prev","$page","e","onscroll","document","documentElement","scrollTop","clientHeight","current","setTimeout","Array","prototype","gridTemplateRows","parseInt","map","cp","backgroundImage","urlbase","scrollTo"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport {useState, useEffect, useRef} from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\nimport Head from \"../components/Head\";\nimport DownDialog from \"../components/downDialog\";\nimport throttle from 'lodash/throttle';\n\nimport {Spin} from \"antd\";\n/*export default class Page extends React.Component {\n    componentDidMount () {\n        likeFun()\n    }\n    render (){\n        return PageFun()\n    }\n}*/\nexport default function() {\n    const [downDialogVisible, setDownDialogVisible] = useState(false);\n    const [list, updateList] = useState([]);\n    const [img, updateImg] = useState({});\n    const [nextDate, updateNextDate] = useState(0);\n    const [loading, updateLoading] = useState(false);\n    const [isMobile, setIsMobile] = useState(false);\n    const [showTop, setShowTop] = useState(false);\n    const [isEmpty, setEmpty] = useState(false);\n    const [sortInfo, setSortInfo] = useState({});\n    const [likeList, setLikeList] = useState([]);\n    const checkMode = () => {\n        if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n            setIsMobile(true);\n            return true;\n        }\n        setIsMobile(false)\n        return false;\n    }\n    const likeFun = (data) => {\n        let localLikeList=window.localStorage.getItem('localLikeList')\n        if(!likeList.length && localLikeList){\n            setLikeList(JSON.parse(localLikeList))\n        }\n        if(data){\n            localLikeList=localLikeList?JSON.parse(localLikeList):[]\n            if(!localLikeList.includes(data)){\n                axios(`/api/sort?date=${data}&k=likeCount`)\n                    .then(res => {\n                        if(res.data.likeCount){\n                            if(!sortInfo[data]){\n                                sortInfo[data]={likeCount:0}\n                            }\n                            sortInfo[data].likeCount=res.data.likeCount\n                            setSortInfo(sortInfo)\n                            localLikeList.push(data)\n                            setLikeList(localLikeList)\n                            window.localStorage.setItem('localLikeList',JSON.stringify(localLikeList))\n                        }\n                    })\n            }\n        }\n    }\n    const throttleLikeFun=throttle((data)=>likeFun(data),1500)\n    if(typeof window !== 'undefined' && window){\n        likeFun()\n    }\n    const downloadFun = (data) => {\n        if(data){\n            axios(`/api/sort?date=${data}&k=downloadCount`)\n                .then(res => {\n                    if(res.data.likeCount){\n                        if(!sortInfo[data]){\n                            sortInfo[data]={downloadCount:0}\n                        }\n                        sortInfo[data].downloadCount=res.data.downloadCount\n                        setSortInfo(sortInfo)\n                    }\n                })\n        }\n    }\n    const queryList = (nextDate, isMobile) => {\n        updateLoading(true);\n        axios(`/api/list?date=${nextDate}&count=10`)\n            .then(({data}) => {\n                let count = 0;\n                const maxCount = isMobile ? 0 : 2;\n                data.data.forEach((item, i) => {\n                    let span = 1;\n                    //0 1 2\n                    (count < maxCount) && maxCount && (span = Math.ceil(Math.random() * 2));\n                    // 10-i,第8张换span  8 16 24 i &&\n                    ((maxCount-count) === (10 - i))  && maxCount && (span = 2);\n                    console.log(span,'span')\n                    // console.log(maxCount, span, isMobile);\n                    span === 2 && (count += 1);\n                    item.style = {\n                        gridColumnStart: `span ${span}`,\n                        gridRowStart: `span ${span}`,\n                    }\n                    item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n                    item.span = span;\n                })\n                const last = data.data.last()\n                updateList([...list, ...data.data]);\n                !last.prev && setEmpty(true);\n                updateNextDate(last.prev);\n                updateLoading(false);\n            })\n    }\n\n    const $page = useRef();\n\n    useEffect((e) => {\n        window.onscroll = () => {\n            if (loading || isEmpty) {\n                return;\n            }\n            setShowTop(document.documentElement.scrollTop > 700);\n            if (document.documentElement.clientHeight + document.documentElement.scrollTop + 50 > $page.current.clientHeight) {\n                queryList(nextDate, isMobile);\n            }\n        }\n        setTimeout(() => {\n            window.onscroll();\n        })\n    }, [nextDate, loading]);\n\n    useEffect(() => {\n        const isMobile = checkMode();\n        Array.prototype.last = function () {\n            return this[this.length - 1];\n        }\n        axios(`/api/sort`)\n            .then(res => {\n                setSortInfo(res.data)\n            })\n        queryList(nextDate, isMobile)\n    }, [])\n    return (\n        <div className={`index-page ${isMobile && 'mobile-page'}`} ref={$page}>\n            <Head></Head>\n            <div className=\"img-list\"\n                 style={{\n                     gridTemplateRows: isMobile ? `repeat(${list.length}, 75vw)` : `repeat(${parseInt(list.length/ 10) * 4}, 19vw)`\n                 }}>\n                {\n                    list.map((img) => (\n                        <div\n                            className=\"img-item\"\n                            style={img.style}\n                            key={img.date}\n                        >\n                            <div className=\"cover\">\n                                <a className=\"iconfont icon-fangda actionBtn\" href={`/${img.date}`}/>\n                                <span className=\"text\">{img.cp}</span>\n                            </div>\n                            <div className={`date-str size-${img.span}`}>{img.dateStr}</div>\n                            <div className=\"img-bg\"\n                                 style={{backgroundImage: `url('//cn.bing.com${img.urlbase}_${false ? '768x1280' : '1024x768'}.jpg')`}}/>\n                             <div className=\"handleButton\">\n                                 <span className={(likeList.includes(img.date)?'icon-like-fill':'icon-xihuan')+' iconfont'} onClick={() => {throttleLikeFun(img.date)}}>\n                                     <span className=\"count\">{sortInfo[img.date] && sortInfo[img.date].likeCount || 0}</span>\n                                 </span>\n                                 <span  onClick={() => {setDownDialogVisible(true);updateImg(img);}} className=\"iconfont icon-download\">\n                                    <span className=\"count\">{sortInfo[img.date] && sortInfo[img.date].downloadCount || 0}</span>\n                                 </span>\n                             </div>\n                        </div>\n                    ))\n                }\n            </div>\n            {isEmpty && <div className=\"empty-text\">—— 到底啦 ——</div>}\n            <div className=\"right-btn\">\n                <div className={`to-top iconfont icon-arrow-left ${!showTop && 'hide'}`}\n                     onClick={() => window.scrollTo(0, 0)}/>\n                <a className=\"iconfont icon-touzi\" href='/random'/>\n            </div>\n            <DownDialog downloadFun={downloadFun} isMobile={isMobile} visible={downDialogVisible} onHide={() => {setDownDialogVisible(false);updateImg({});}}\n                        imgInfo={img}/>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}