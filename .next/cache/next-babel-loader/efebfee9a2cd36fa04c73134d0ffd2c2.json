{"ast":null,"code":"import { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\n\nvar _s = $RefreshSig$();\n\nimport { useRouter } from \"next/router\";\nimport { useState, useEffect, useRef } from 'react';\nimport { message, Spin } from \"antd\";\nimport moment from \"moment\";\nimport '../styles/[date].scss';\nimport DownDialog from \"../components/downDialog\";\nimport Error from 'next/error';\nimport axios from \"axios\";\nimport throttle from \"lodash/throttle\";\nimport Head from \"../components/Head\";\nimport processHTML from \"next/dist/next-server/lib/post-process\"; // import axios from \"axios\";\n// import throttle from \"lodash/throttle\";\n\nexport var __N_SSP = true;\nexport default function date(_ref) {\n  _s();\n\n  var minDate = _ref.minDate,\n      maxDate = _ref.maxDate,\n      _ref$img = _ref.img,\n      img = _ref$img === void 0 ? {} : _ref$img,\n      timeout = _ref.timeout,\n      nextKey = _ref.nextKey;\n  var router = useRouter();\n\n  var _useState = useState(true),\n      loading = _useState[0],\n      updateLoading = _useState[1];\n\n  var _useState2 = useState(true),\n      showBottom = _useState2[0],\n      updateShowBottom = _useState2[1];\n\n  var _useState3 = useState(new Date().valueOf()),\n      now = _useState3[0],\n      updateNow = _useState3[1];\n\n  var _useState4 = useState(false),\n      downDialogVisible = _useState4[0],\n      setDownDialogVisible = _useState4[1];\n\n  var _useState5 = useState(false),\n      isMobile = _useState5[0],\n      setIsMobile = _useState5[1];\n\n  var _useState6 = useState([]),\n      likeList = _useState6[0],\n      setLikeList = _useState6[1];\n\n  var checkMode = function checkMode() {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n    } else {\n      setIsMobile(false);\n    }\n  }; // likeFun\n\n\n  var likeFun = function likeFun(data) {\n    var localLikeList = window.localStorage.getItem('localLikeList');\n\n    if (!likeList.length && localLikeList) {\n      setLikeList(JSON.parse(localLikeList));\n    }\n\n    if (data) {\n      localLikeList = localLikeList ? JSON.parse(localLikeList) : [];\n\n      if (!localLikeList.includes(data)) {\n        axios(\"/api/sort?date=\".concat(data, \"&k=likeCount\")).then(function (res) {\n          if (res.data.likeCount) {\n            localLikeList.push(data);\n            setLikeList(localLikeList);\n            window.localStorage.setItem('localLikeList', JSON.stringify(localLikeList));\n          }\n        });\n      }\n    }\n  };\n\n  var throttleLikeFun = throttle(function (data) {\n    return likeFun(data);\n  }, 1500);\n\n  var downloadFun = function downloadFun(data) {\n    if (data) {\n      axios(\"/api/sort?date=\".concat(data, \"&k=downloadCount\"));\n    }\n  }; // did mount\n\n\n  var loadingImg = useRef();\n  useEffect(function () {\n    likeFun(); // 图片加载完成就取消 loading\n\n    if (loadingImg.current && loadingImg.current.complete) {\n      updateLoading(false);\n    }\n\n    checkMode();\n\n    window.onkeyup = function (_ref2) {\n      var keyCode = _ref2.keyCode;\n\n      switch (keyCode) {\n        case 32:\n          return window.location = \"/random\";\n\n        /*const date = Math.floor(Math.random() * (maxDate-minDate))+minDate;\r\n        changePosition(date);*/\n\n        case 37:\n        case 39:\n          changePosition({\n            37: 'prev',\n            39: 'next'\n          }[keyCode]);\n          break;\n\n        default:\n          break;\n      }\n    };\n\n    window.onresize = checkMode;\n    setTimeout(function () {\n      !img.next && (img.next = nextKey);\n    }, timeout);\n  }, []); // 前后切换\n\n  var changePosition = function changePosition(key) {\n    if (!img[key]) {\n      return message.warning({\n        prev: '没有更早的辣！',\n        next: '已经是最新的辣！'\n      }[key]);\n    }\n\n    updateLoading(true);\n    window.location = \"/\".concat(img[key]);\n  }; // 移动鼠标，显示底下区域\n\n\n  var onMouseMove = function onMouseMove() {\n    updateShowBottom(true);\n    updateNow(new Date().valueOf());\n  };\n\n  useEffect(function () {\n    var tick = setTimeout(function () {\n      return updateShowBottom(false);\n    }, 3500);\n    return function () {\n      clearTimeout(tick);\n    };\n  }, [now]);\n  var imgDate = moment(String(img.date), 'YYYYMMDD');\n  return img.date ? /*#__PURE__*/_jsxs(Spin, {\n    spinning: loading,\n    size: \"large\",\n    children: [/*#__PURE__*/_jsx(Head, {}), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"detail-page \".concat(isMobile && 'mobile-mode'),\n      onMouseMove: onMouseMove,\n      children: [/*#__PURE__*/_jsx(\"img\", {\n        className: \"loading-img\",\n        ref: loadingImg,\n        src: \"//cn.bing.com\".concat(img.urlbase, \"_\").concat(isMobile ? '768x1280' : '1920x1080', \".jpg\"),\n        onLoad: function onLoad() {\n          return updateLoading(false);\n        }\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"img-content-box\",\n        style: {\n          backgroundImage: \"url(//cn.bing.com\".concat(img.urlbase, \"_\").concat(isMobile ? '768x1280' : '1920x1080', \".jpg)\")\n        },\n        children: [[{\n          key: 'prev',\n          arrow: 'left'\n        }, {\n          key: 'next',\n          arrow: 'right'\n        }].map(function (_ref3) {\n          var key = _ref3.key,\n              arrow = _ref3.arrow;\n          return img[key] ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"page-icon icon-\".concat(arrow, \" \").concat((showBottom || isMobile) && 'actived'),\n            onClick: function onClick() {\n              return changePosition(key);\n            },\n            children: /*#__PURE__*/_jsx(\"i\", {\n              className: \"iconfont icon-arrow-\".concat(arrow)\n            })\n          }, \"page-\".concat(arrow)) : '';\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"img-info\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"img-date\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"img-date-year\",\n              children: imgDate.format('YY')\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"img-date-md\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                children: imgDate.format('MM')\n              }), /*#__PURE__*/_jsx(\"div\", {\n                children: imgDate.format('DD')\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"img-cp\",\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"img-cp-txt\",\n              children: img.cp\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"bottom-info \".concat(showBottom && 'actived'),\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"icon-list\",\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              href: \"/\",\n              className: \"iconfont icon-bing\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: (likeList.includes(img.date) ? 'icon-like-fill' : 'icon-xihuan') + ' iconfont',\n              onClick: function onClick() {\n                return throttleLikeFun(img.date);\n              }\n            }), \")\", /*#__PURE__*/_jsx(\"div\", {\n              className: \"iconfont icon-download\",\n              onClick: function onClick() {\n                return setDownDialogVisible(true);\n              }\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"/random\",\n              className: \"iconfont icon-touzi\"\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"/about\",\n              className: \"iconfont icon-about\"\n            }), /*#__PURE__*/_jsx(\"a\", {\n              href: \"https://github.com/renserve/bing\",\n              rel: \"external nofollow noopener noreferrer\",\n              target: \"_blank\",\n              className: \"iconfont icon-github\"\n            })]\n          })\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(DownDialog, {\n      downloadFun: downloadFun,\n      isMobile: isMobile,\n      visible: downDialogVisible,\n      onHide: function onHide() {\n        return setDownDialogVisible(false);\n      },\n      imgInfo: img\n    })]\n  }) : /*#__PURE__*/_jsx(Error, {\n    statusCode: 404\n  });\n}\n\n_s(date, \"8b/OswjejDOG9+7nFDdzkuHla74=\", false, function () {\n  return [useRouter];\n});","map":{"version":3,"sources":["E:/Future/bing/pages/[date].js"],"names":["useRouter","useState","useEffect","useRef","message","Spin","moment","DownDialog","Error","axios","throttle","Head","processHTML","date","minDate","maxDate","img","timeout","nextKey","router","loading","updateLoading","showBottom","updateShowBottom","Date","valueOf","now","updateNow","downDialogVisible","setDownDialogVisible","isMobile","setIsMobile","likeList","setLikeList","checkMode","window","innerWidth","innerHeight","likeFun","data","localLikeList","localStorage","getItem","length","JSON","parse","includes","then","res","likeCount","push","setItem","stringify","throttleLikeFun","downloadFun","loadingImg","current","complete","onkeyup","keyCode","location","changePosition","onresize","setTimeout","next","key","warning","prev","onMouseMove","tick","clearTimeout","imgDate","String","urlbase","backgroundImage","arrow","map","format","cp"],"mappings":"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","sourcesContent":["import {useRouter} from \"next/router\";\r\nimport {useState, useEffect, useRef} from 'react';\r\nimport {message, Spin} from \"antd\";\r\nimport moment from \"moment\";\r\nimport '../styles/[date].scss';\r\nimport DownDialog from \"../components/downDialog\";\r\nimport Error from 'next/error';\r\nimport maxBy from 'lodash/maxBy'\r\nimport minBy from 'lodash/minBy'\r\nimport axios from \"axios\";\r\nimport throttle from \"lodash/throttle\";\r\nimport Head from \"../components/Head\";\r\nimport processHTML from \"next/dist/next-server/lib/post-process\";\r\n// import axios from \"axios\";\r\n// import throttle from \"lodash/throttle\";\r\nexport async function getServerSideProps(context) {\r\n    // 维护一份文件索引表length\r\n    const {imgArr, tomorrow} = global;\r\n    const {date} = context.query;\r\n    // 抽取随机数进行随机，接口返回最大数量的随机数\r\n    let key = date;\r\n    const minDate=minBy(imgArr,'date')\r\n    const maxDate=maxBy(imgArr,'date')\r\n    if (date === 'random') {\r\n        const index = Math.floor(Math.random() * imgArr.length);\r\n        key = imgArr[index].date;\r\n    }\r\n    return {\r\n        props: {\r\n            minDate,\r\n            maxDate,\r\n            img: imgArr[key] || {},\r\n            timeout: tomorrow - moment() + 5000,\r\n            nextKey: tomorrow.format('YYYYMMDD')\r\n        }\r\n    }\r\n}\r\n\r\nexport default function date({minDate,maxDate,img = {}, timeout, nextKey}) {\r\n    const router = useRouter();\r\n\r\n    const [loading, updateLoading] = useState(true);\r\n    const [showBottom, updateShowBottom] = useState(true);\r\n    const [now, updateNow] = useState(new Date().valueOf());\r\n    const [downDialogVisible, setDownDialogVisible] = useState(false);\r\n    const [isMobile, setIsMobile] = useState(false);\r\n    const [likeList, setLikeList] = useState([]);\r\n\r\n    const checkMode = () => {\r\n        if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\r\n            setIsMobile(true);\r\n        } else {\r\n            setIsMobile(false);\r\n        }\r\n    }\r\n    // likeFun\r\n    const likeFun = (data) => {\r\n        let localLikeList=window.localStorage.getItem('localLikeList')\r\n        if(!likeList.length && localLikeList){\r\n            setLikeList(JSON.parse(localLikeList))\r\n        }\r\n        if(data){\r\n            localLikeList=localLikeList?JSON.parse(localLikeList):[]\r\n            if(!localLikeList.includes(data)){\r\n                axios(`/api/sort?date=${data}&k=likeCount`)\r\n                    .then(res => {\r\n                        if(res.data.likeCount){\r\n                            localLikeList.push(data)\r\n                            setLikeList(localLikeList)\r\n                            window.localStorage.setItem('localLikeList',JSON.stringify(localLikeList))\r\n                        }\r\n                    })\r\n            }\r\n        }\r\n    }\r\n    const throttleLikeFun=throttle((data)=>likeFun(data),1500)\r\n    const downloadFun = (data) => {\r\n        if(data){\r\n            axios(`/api/sort?date=${data}&k=downloadCount`)\r\n        }\r\n    }\r\n    // did mount\r\n    const loadingImg = useRef();\r\n    useEffect(() => {\r\n        likeFun()\r\n        // 图片加载完成就取消 loading\r\n        if (loadingImg.current && loadingImg.current.complete) {\r\n            updateLoading(false);\r\n        }\r\n        checkMode();\r\n        window.onkeyup = ({keyCode}) => {\r\n            switch (keyCode) {\r\n                case 32:\r\n                    return window.location = `/random`;\r\n                    /*const date = Math.floor(Math.random() * (maxDate-minDate))+minDate;\r\n                    changePosition(date);*/\r\n                case 37:\r\n                case 39:\r\n                    changePosition({37: 'prev', 39: 'next'}[keyCode]);\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        window.onresize = checkMode;\r\n\r\n        setTimeout(() => {\r\n            !img.next && (img.next = nextKey);\r\n        }, timeout)\r\n    }, []);\r\n    // 前后切换\r\n    const changePosition = (key) => {\r\n        if (!img[key]) {\r\n            return message.warning({\r\n                prev: '没有更早的辣！',\r\n                next: '已经是最新的辣！',\r\n            }[key])\r\n        }\r\n        updateLoading(true);\r\n        window.location = `/${img[key]}`;\r\n    }\r\n\r\n    // 移动鼠标，显示底下区域\r\n    const onMouseMove = () => {\r\n        updateShowBottom(true);\r\n        updateNow(new Date().valueOf())\r\n    }\r\n    useEffect(\r\n        () => {\r\n            const tick = setTimeout(() => updateShowBottom(false), 3500);\r\n            return () => {\r\n                clearTimeout(tick);\r\n            };\r\n        },\r\n        [now]\r\n    );\r\n\r\n    const imgDate = moment(String(img.date), 'YYYYMMDD');\r\n\r\n    return img.date ? (\r\n        <Spin spinning={loading} size=\"large\">\r\n            <Head></Head>\r\n            <div className={`detail-page ${isMobile && 'mobile-mode'}`} onMouseMove={onMouseMove}>\r\n                <img className=\"loading-img\" ref={loadingImg}\r\n                     src={`//cn.bing.com${img.urlbase}_${isMobile ? '768x1280' : '1920x1080'}.jpg`}\r\n                     onLoad={() => updateLoading(false)}/>\r\n                <div\r\n                    className=\"img-content-box\"\r\n                    style={{backgroundImage: `url(//cn.bing.com${img.urlbase}_${isMobile ? '768x1280' : '1920x1080'}.jpg)`}}\r\n                >\r\n                    {\r\n                        [{key: 'prev', arrow: 'left'}, {key: 'next', arrow: 'right'}]\r\n                            .map(({key, arrow}) => (\r\n                                img[key] ? (\r\n                                    <div key={`page-${arrow}`}\r\n                                         className={`page-icon icon-${arrow} ${(showBottom || isMobile) && 'actived'}`}\r\n                                         onClick={() => changePosition(key)}>\r\n                                        <i className={`iconfont icon-arrow-${arrow}`}/>\r\n                                    </div>\r\n                                ) : ''\r\n                            ))\r\n                    }\r\n\r\n                    <div className=\"img-info\">\r\n                        <div className=\"img-date\">\r\n                            <div className=\"img-date-year\">{imgDate.format('YY')}</div>\r\n                            <div className=\"img-date-md\">\r\n                                <div>{imgDate.format('MM')}</div>\r\n                                <div>{imgDate.format('DD')}</div>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"img-cp\">\r\n                            <div className=\"img-cp-txt\">{img.cp}</div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className={`bottom-info ${showBottom && 'actived'}`}>\r\n                        <div className=\"icon-list\">\r\n                            <a href=\"/\" className=\"iconfont icon-bing\"/>\r\n                            <div className={(likeList.includes(img.date)?'icon-like-fill':'icon-xihuan')+' iconfont'} onClick={() => throttleLikeFun(img.date)}/>)\r\n                            <div className=\"iconfont icon-download\" onClick={() => setDownDialogVisible(true)}/>\r\n                            <a href=\"/random\" className=\"iconfont icon-touzi\"/>\r\n                            <a href=\"/about\" className=\"iconfont icon-about\"/>\r\n                            <a href=\"https://github.com/renserve/bing\" rel=\"external nofollow noopener noreferrer\"\r\n                               target=\"_blank\" className=\"iconfont icon-github\"/>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <DownDialog downloadFun={downloadFun} isMobile={isMobile} visible={downDialogVisible} onHide={() => setDownDialogVisible(false)}\r\n                        imgInfo={img}/>\r\n        </Spin>\r\n    ) : <Error statusCode={404}/>\r\n}\r\n"]},"metadata":{},"sourceType":"module"}