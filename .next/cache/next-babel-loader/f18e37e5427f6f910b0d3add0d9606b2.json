{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport axios from 'axios';\nimport { useState, useEffect, useRef } from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\nimport Head from \"../components/Head\";\nimport DownDialog from \"../components/downDialog\";\nimport throttle from 'lodash/throttle';\nimport { Spin } from \"antd\";\n/*export default class Page extends React.Component {\n    componentDidMount () {\n        likeFun()\n    }\n    render (){\n        return PageFun()\n    }\n}*/\n\nexport default function () {\n  var _useState = useState(false),\n      downDialogVisible = _useState[0],\n      setDownDialogVisible = _useState[1];\n\n  var _useState2 = useState([]),\n      list = _useState2[0],\n      updateList = _useState2[1];\n\n  var _useState3 = useState({}),\n      img = _useState3[0],\n      updateImg = _useState3[1];\n\n  var _useState4 = useState(0),\n      nextDate = _useState4[0],\n      updateNextDate = _useState4[1];\n\n  var _useState5 = useState(false),\n      loading = _useState5[0],\n      updateLoading = _useState5[1];\n\n  var _useState6 = useState(false),\n      isMobile = _useState6[0],\n      setIsMobile = _useState6[1];\n\n  var _useState7 = useState(false),\n      showTop = _useState7[0],\n      setShowTop = _useState7[1];\n\n  var _useState8 = useState(false),\n      isEmpty = _useState8[0],\n      setEmpty = _useState8[1];\n\n  var _useState9 = useState({}),\n      sortInfo = _useState9[0],\n      setSortInfo = _useState9[1];\n\n  var _useState10 = useState([]),\n      likeList = _useState10[0],\n      setLikeList = _useState10[1];\n\n  var checkMode = function checkMode() {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n      return true;\n    }\n\n    setIsMobile(false);\n    return false;\n  };\n\n  var likeFun = function likeFun(data) {\n    var localLikeList = window.localStorage.getItem('localLikeList');\n\n    if (!likeList.length && localLikeList) {\n      setLikeList(JSON.parse(localLikeList));\n    }\n\n    if (data) {\n      localLikeList = localLikeList ? JSON.parse(localLikeList) : [];\n\n      if (!localLikeList.includes(data)) {\n        axios(\"/api/sort?date=\".concat(data, \"&k=likeCount\")).then(function (res) {\n          if (res.data.likeCount) {\n            if (!sortInfo[data]) {\n              sortInfo[data] = {\n                likeCount: 0\n              };\n            }\n\n            sortInfo[data].likeCount = res.data.likeCount;\n            setSortInfo(sortInfo);\n            localLikeList.push(data);\n            setLikeList(localLikeList);\n            window.localStorage.setItem('localLikeList', JSON.stringify(localLikeList));\n          }\n        });\n      }\n    }\n  };\n\n  var throttleLikeFun = throttle(function (data) {\n    return likeFun(data);\n  }, 1500);\n\n  if (true && window) {\n    likeFun();\n  }\n\n  var downloadFun = function downloadFun(data) {\n    if (data) {\n      axios(\"/api/sort?date=\".concat(data, \"&k=downloadCount\")).then(function (res) {\n        if (res.data.likeCount) {\n          if (!sortInfo[data]) {\n            sortInfo[data] = {\n              downloadCount: 0\n            };\n          }\n\n          sortInfo[data].downloadCount = res.data.downloadCount;\n          setSortInfo(sortInfo);\n        }\n      });\n    }\n  };\n\n  var queryList = function queryList(nextDate, isMobile) {\n    updateLoading(true);\n    axios(\"/api/list?date=\".concat(nextDate, \"&count=10\")).then(function (_ref) {\n      var data = _ref.data;\n      var count = 0;\n      var maxCount = isMobile ? 0 : 2;\n      data.data.forEach(function (item, i) {\n        var span = 1; //0 1 2\n\n        count < maxCount && maxCount && (span = Math.ceil(Math.random() * 2)); // 2,第9张换span  ;  1 最后一张span ;\n\n        maxCount - count === 10 - i && maxCount && (span = 2); // count=1 ; count=2 ;\n\n        span === 2 && (count += 1);\n        item.style = {\n          gridColumnStart: \"span \".concat(span),\n          gridRowStart: \"span \".concat(span)\n        };\n        item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n        item.span = span;\n      });\n      var last = data.data.last();\n      updateList([].concat(_toConsumableArray(list), _toConsumableArray(data.data)));\n      !last.prev && setEmpty(true);\n      updateNextDate(last.prev);\n      updateLoading(false);\n    });\n  };\n\n  var $page = useRef();\n  useEffect(function (e) {\n    window.onscroll = throttle(function () {\n      if (loading || isEmpty) {\n        return;\n      }\n\n      setShowTop(document.documentElement.scrollTop > 700);\n      var scrollTop = document.documentElement.scrollTop;\n      var clientHeight = document.documentElement.clientHeight;\n      var pageHeight = $page.current.clientHeight;\n\n      if (scrollTop && clientHeight + scrollTop + 80 > pageHeight) {\n        queryList(nextDate, isMobile);\n      }\n    }, 100);\n    window.onscroll();\n  }, [nextDate, loading]);\n  useEffect(function () {\n    var isMobile = checkMode();\n\n    Array.prototype.last = function () {\n      return this[this.length - 1];\n    };\n\n    axios(\"/api/sort\").then(function (res) {\n      setSortInfo(res.data);\n    });\n    queryList(nextDate, isMobile);\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"index-page \".concat(isMobile && 'mobile-page'),\n    ref: $page,\n    children: [/*#__PURE__*/_jsx(Head, {}), /*#__PURE__*/_jsx(\"div\", {\n      className: \"img-list\",\n      style: {\n        gridTemplateRows: isMobile ? \"repeat(\".concat(list.length, \", 75vw)\") : \"repeat(\".concat(parseInt(list.length / 10) * 4, \", 19vw)\")\n      },\n      children: list.map(function (img) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          className: \"img-item\",\n          style: img.style,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"cover\",\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              className: \"iconfont icon-fangda actionBtn\",\n              href: \"/\".concat(img.date)\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"text\",\n              children: img.cp\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"date-str size-\".concat(img.span),\n            children: img.dateStr\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"img-bg\",\n            style: {\n              backgroundImage: \"url('//cn.bing.com\".concat(img.urlbase, \"_\").concat(false ? '768x1280' : '1024x768', \".jpg')\")\n            }\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"handleButton\",\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              className: (likeList.includes(img.date) ? 'icon-like-fill' : 'icon-xihuan') + ' iconfont',\n              onClick: function onClick() {\n                throttleLikeFun(img.date);\n              },\n              children: /*#__PURE__*/_jsx(\"span\", {\n                className: \"count\",\n                children: sortInfo[img.date] && sortInfo[img.date].likeCount || 0\n              })\n            }), /*#__PURE__*/_jsx(\"span\", {\n              onClick: function onClick() {\n                setDownDialogVisible(true);\n                updateImg(img);\n              },\n              className: \"iconfont icon-download\",\n              children: /*#__PURE__*/_jsx(\"span\", {\n                className: \"count\",\n                children: sortInfo[img.date] && sortInfo[img.date].downloadCount || 0\n              })\n            })]\n          })]\n        }, img.date);\n      })\n    }), isEmpty && /*#__PURE__*/_jsx(\"div\", {\n      className: \"empty-text\",\n      children: \"\\u2014\\u2014 \\u5230\\u5E95\\u5566 \\u2014\\u2014\"\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"right-btn\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"to-top iconfont icon-arrow-left \".concat(!showTop && 'hide'),\n        onClick: function onClick() {\n          return window.scrollTo(0, 0);\n        }\n      }), /*#__PURE__*/_jsx(\"a\", {\n        className: \"iconfont icon-touzi\",\n        href: \"/random\"\n      })]\n    }), /*#__PURE__*/_jsx(DownDialog, {\n      downloadFun: downloadFun,\n      isMobile: isMobile,\n      visible: downDialogVisible,\n      onHide: function onHide() {\n        setDownDialogVisible(false);\n        updateImg({});\n      },\n      imgInfo: img\n    })]\n  });\n}","map":null,"metadata":{},"sourceType":"module"}