{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport axios from 'axios';\nimport { useState, useEffect, useRef } from 'react';\nimport '../styles/index.scss';\nimport moment from 'moment';\nimport Head from \"../components/Head\";\nimport DownDialog from \"../components/downDialog\";\nimport throttle from 'lodash/throttle';\nimport { Spin } from \"antd\";\n/*export default class Page extends React.Component {\r\n    componentDidMount () {\r\n        likeFun()\r\n    }\r\n    render (){\r\n        return PageFun()\r\n    }\r\n}*/\n\nexport default function () {\n  var _useState = useState(false),\n      downDialogVisible = _useState[0],\n      setDownDialogVisible = _useState[1];\n\n  var _useState2 = useState([]),\n      list = _useState2[0],\n      updateList = _useState2[1];\n\n  var _useState3 = useState({}),\n      img = _useState3[0],\n      updateImg = _useState3[1];\n\n  var _useState4 = useState(0),\n      nextDate = _useState4[0],\n      updateNextDate = _useState4[1];\n\n  var _useState5 = useState(false),\n      loading = _useState5[0],\n      updateLoading = _useState5[1];\n\n  var _useState6 = useState(false),\n      isMobile = _useState6[0],\n      setIsMobile = _useState6[1];\n\n  var _useState7 = useState(false),\n      showTop = _useState7[0],\n      setShowTop = _useState7[1];\n\n  var _useState8 = useState(false),\n      isEmpty = _useState8[0],\n      setEmpty = _useState8[1];\n\n  var _useState9 = useState({}),\n      sortInfo = _useState9[0],\n      setSortInfo = _useState9[1];\n\n  var _useState10 = useState([]),\n      likeList = _useState10[0],\n      setLikeList = _useState10[1];\n\n  var checkMode = function checkMode() {\n    if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\n      setIsMobile(true);\n      return true;\n    }\n\n    setIsMobile(false);\n    return false;\n  };\n\n  var likeFun = function likeFun(data) {\n    var localLikeList = window.localStorage.getItem('localLikeList');\n\n    if (!likeList.length && localLikeList) {\n      setLikeList(JSON.parse(localLikeList));\n    }\n\n    if (data) {\n      localLikeList = localLikeList ? JSON.parse(localLikeList) : [];\n\n      if (!localLikeList.includes(data)) {\n        axios(\"/api/sort?date=\".concat(data, \"&k=likeCount\")).then(function (res) {\n          if (res.data.likeCount) {\n            if (!sortInfo[data]) {\n              sortInfo[data] = {\n                likeCount: 0\n              };\n            }\n\n            sortInfo[data].likeCount = res.data.likeCount;\n            setSortInfo(sortInfo);\n            localLikeList.push(data);\n            setLikeList(localLikeList);\n            window.localStorage.setItem('localLikeList', JSON.stringify(localLikeList));\n          }\n        });\n      }\n    }\n  };\n\n  var throttleLikeFun = throttle(function (data) {\n    return likeFun(data);\n  }, 1500);\n\n  if (true && window) {\n    likeFun();\n  }\n\n  var downloadFun = function downloadFun(data) {\n    if (data) {\n      axios(\"/api/sort?date=\".concat(data, \"&k=downloadCount\")).then(function (res) {\n        if (res.data.likeCount) {\n          if (!sortInfo[data]) {\n            sortInfo[data] = {\n              downloadCount: 0\n            };\n          }\n\n          sortInfo[data].downloadCount = res.data.downloadCount;\n          setSortInfo(sortInfo);\n        }\n      });\n    }\n  };\n\n  var queryList = function queryList(nextDate, isMobile) {\n    updateLoading(true);\n    axios(\"/api/list?date=\".concat(nextDate, \"&count=10\")).then(function (_ref) {\n      var data = _ref.data;\n      var count = 0;\n      var maxCount = isMobile ? 0 : 2;\n      data.data.forEach(function (item, i) {\n        var span = 1; //0 1 2\n\n        count < maxCount && maxCount && (span = Math.ceil(Math.random() * 2)); // 2,第9张换span  ;  1 最后一张span ;\n\n        maxCount - count === 10 - i && maxCount && (span = 2); // count=1 ; count=2 ;\n\n        span === 2 && (count += 1);\n        item.style = {\n          gridColumnStart: \"span \".concat(span),\n          gridRowStart: \"span \".concat(span)\n        };\n        item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\n        item.span = span;\n      });\n      var last = data.data.last();\n      updateList([].concat(_toConsumableArray(list), _toConsumableArray(data.data)));\n      !last.prev && setEmpty(true);\n      updateNextDate(last.prev);\n      updateLoading(false);\n    });\n  };\n\n  var $page = useRef();\n  useEffect(function (e) {\n    window.onscroll = throttle(function () {\n      if (loading || isEmpty) {\n        return;\n      }\n\n      setShowTop(document.documentElement.scrollTop > 700);\n      var scrollTop = document.documentElement.scrollTop;\n      var clientHeight = document.documentElement.clientHeight;\n      var pageHeight = $page.current.clientHeight;\n\n      if (scrollTop && clientHeight + scrollTop + 150 > pageHeight) {\n        queryList(nextDate, isMobile);\n      }\n\n      console.log(clientHeight + scrollTop, pageHeight);\n    }, 100);\n    window.onscroll();\n  }, [nextDate, loading]);\n  useEffect(function () {\n    var isMobile = checkMode();\n\n    Array.prototype.last = function () {\n      return this[this.length - 1];\n    };\n\n    axios(\"/api/sort\").then(function (res) {\n      setSortInfo(res.data);\n    });\n    queryList(nextDate, isMobile);\n    true && setTimeout(function () {\n      var VConsole = require('vconsole');\n\n      new VConsole();\n    });\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"index-page \".concat(isMobile && 'mobile-page'),\n    ref: $page,\n    children: [/*#__PURE__*/_jsx(Head, {}), /*#__PURE__*/_jsx(\"div\", {\n      className: \"img-list\",\n      style: {\n        gridTemplateRows: isMobile ? \"repeat(\".concat(list.length, \", 75vw)\") : \"repeat(\".concat(parseInt(list.length / 10) * 4, \", 19vw)\")\n      },\n      children: list.map(function (img) {\n        return /*#__PURE__*/_jsxs(\"div\", {\n          className: \"img-item\",\n          style: img.style,\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"cover\",\n            children: [/*#__PURE__*/_jsx(\"a\", {\n              className: \"iconfont icon-fangda actionBtn\",\n              href: \"/\".concat(img.date)\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"text\",\n              children: img.cp\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"date-str size-\".concat(img.span),\n            children: img.dateStr\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"img-bg\",\n            style: {\n              backgroundImage: \"url('//cn.bing.com\".concat(img.urlbase, \"_\").concat(false ? '768x1280' : '1024x768', \".jpg')\")\n            }\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"handleButton\",\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              className: (likeList.includes(img.date) ? 'icon-like-fill' : 'icon-xihuan') + ' iconfont',\n              onClick: function onClick() {\n                throttleLikeFun(img.date);\n              },\n              children: /*#__PURE__*/_jsx(\"span\", {\n                className: \"count\",\n                children: sortInfo[img.date] && sortInfo[img.date].likeCount || 0\n              })\n            }), /*#__PURE__*/_jsx(\"span\", {\n              onClick: function onClick() {\n                setDownDialogVisible(true);\n                updateImg(img);\n              },\n              className: \"iconfont icon-download\",\n              children: /*#__PURE__*/_jsx(\"span\", {\n                className: \"count\",\n                children: sortInfo[img.date] && sortInfo[img.date].downloadCount || 0\n              })\n            })]\n          })]\n        }, img.date);\n      })\n    }), isEmpty && /*#__PURE__*/_jsx(\"div\", {\n      className: \"empty-text\",\n      children: \"\\u2014\\u2014 \\u5230\\u5E95\\u5566 \\u2014\\u2014\"\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: \"right-btn\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"to-top iconfont icon-arrow-left \".concat(!showTop && 'hide'),\n        onClick: function onClick() {\n          return window.scrollTo(0, 0);\n        }\n      }), /*#__PURE__*/_jsx(\"a\", {\n        className: \"iconfont icon-touzi\",\n        href: \"/random\"\n      })]\n    }), /*#__PURE__*/_jsx(DownDialog, {\n      downloadFun: downloadFun,\n      isMobile: isMobile,\n      visible: downDialogVisible,\n      onHide: function onHide() {\n        setDownDialogVisible(false);\n        updateImg({});\n      },\n      imgInfo: img\n    })]\n  });\n}","map":{"version":3,"sources":["E:/Future/bing/pages/index.js"],"names":["axios","useState","useEffect","useRef","moment","Head","DownDialog","throttle","Spin","downDialogVisible","setDownDialogVisible","list","updateList","img","updateImg","nextDate","updateNextDate","loading","updateLoading","isMobile","setIsMobile","showTop","setShowTop","isEmpty","setEmpty","sortInfo","setSortInfo","likeList","setLikeList","checkMode","window","innerWidth","innerHeight","likeFun","data","localLikeList","localStorage","getItem","length","JSON","parse","includes","then","res","likeCount","push","setItem","stringify","throttleLikeFun","downloadFun","downloadCount","queryList","count","maxCount","forEach","item","i","span","Math","ceil","random","style","gridColumnStart","gridRowStart","dateStr","date","format","last","prev","$page","e","onscroll","document","documentElement","scrollTop","clientHeight","pageHeight","current","console","log","Array","prototype","setTimeout","VConsole","require","gridTemplateRows","parseInt","map","cp","backgroundImage","urlbase","scrollTo"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\nimport {useState, useEffect, useRef} from 'react';\r\nimport '../styles/index.scss';\r\nimport moment from 'moment';\r\nimport Head from \"../components/Head\";\r\nimport DownDialog from \"../components/downDialog\";\r\nimport throttle from 'lodash/throttle';\r\n\r\nimport {Spin} from \"antd\";\r\n/*export default class Page extends React.Component {\r\n    componentDidMount () {\r\n        likeFun()\r\n    }\r\n    render (){\r\n        return PageFun()\r\n    }\r\n}*/\r\nexport default function() {\r\n    const [downDialogVisible, setDownDialogVisible] = useState(false);\r\n    const [list, updateList] = useState([]);\r\n    const [img, updateImg] = useState({});\r\n    const [nextDate, updateNextDate] = useState(0);\r\n    const [loading, updateLoading] = useState(false);\r\n    const [isMobile, setIsMobile] = useState(false);\r\n    const [showTop, setShowTop] = useState(false);\r\n    const [isEmpty, setEmpty] = useState(false);\r\n    const [sortInfo, setSortInfo] = useState({});\r\n    const [likeList, setLikeList] = useState([]);\r\n    const checkMode = () => {\r\n        if (window.innerWidth < 1024 || window.innerWidth < window.innerHeight) {\r\n            setIsMobile(true);\r\n            return true;\r\n        }\r\n        setIsMobile(false)\r\n        return false;\r\n    }\r\n    const likeFun = (data) => {\r\n        let localLikeList=window.localStorage.getItem('localLikeList')\r\n        if(!likeList.length && localLikeList){\r\n            setLikeList(JSON.parse(localLikeList))\r\n        }\r\n        if(data){\r\n            localLikeList=localLikeList?JSON.parse(localLikeList):[]\r\n            if(!localLikeList.includes(data)){\r\n                axios(`/api/sort?date=${data}&k=likeCount`)\r\n                    .then(res => {\r\n                        if(res.data.likeCount){\r\n                            if(!sortInfo[data]){\r\n                                sortInfo[data]={likeCount:0}\r\n                            }\r\n                            sortInfo[data].likeCount=res.data.likeCount\r\n                            setSortInfo(sortInfo)\r\n                            localLikeList.push(data)\r\n                            setLikeList(localLikeList)\r\n                            window.localStorage.setItem('localLikeList',JSON.stringify(localLikeList))\r\n                        }\r\n                    })\r\n            }\r\n        }\r\n    }\r\n    const throttleLikeFun=throttle((data)=>likeFun(data),1500)\r\n    if(typeof window !== 'undefined' && window){\r\n        likeFun()\r\n    }\r\n    const downloadFun = (data) => {\r\n        if(data){\r\n            axios(`/api/sort?date=${data}&k=downloadCount`)\r\n                .then(res => {\r\n                    if(res.data.likeCount){\r\n                        if(!sortInfo[data]){\r\n                            sortInfo[data]={downloadCount:0}\r\n                        }\r\n                        sortInfo[data].downloadCount=res.data.downloadCount\r\n                        setSortInfo(sortInfo)\r\n                    }\r\n                })\r\n        }\r\n    }\r\n    const queryList = (nextDate, isMobile) => {\r\n        updateLoading(true);\r\n        axios(`/api/list?date=${nextDate}&count=10`)\r\n            .then(({data}) => {\r\n                let count = 0;\r\n                const maxCount = isMobile ? 0 : 2;\r\n                data.data.forEach((item, i) => {\r\n                    let span = 1;\r\n                    //0 1 2\r\n                    (count < maxCount) && maxCount && (span = Math.ceil(Math.random() * 2));\r\n                    // 2,第9张换span  ;  1 最后一张span ;\r\n                    ((maxCount-count) === (10 - i)) && maxCount && (span = 2);\r\n                    // count=1 ; count=2 ;\r\n                    span === 2 && (count += 1);\r\n                    item.style = {\r\n                        gridColumnStart: `span ${span}`,\r\n                        gridRowStart: `span ${span}`,\r\n                    }\r\n                    item.dateStr = moment(item.date, 'YYYYMMDD').format('YY.MM.DD');\r\n                    item.span = span;\r\n                })\r\n                const last = data.data.last()\r\n                updateList([...list, ...data.data]);\r\n                !last.prev && setEmpty(true);\r\n                updateNextDate(last.prev);\r\n                updateLoading(false);\r\n            })\r\n    }\r\n\r\n    const $page = useRef();\r\n\r\n    useEffect((e) => {\r\n        window.onscroll = throttle(() => {\r\n            if (loading || isEmpty) {\r\n                return;\r\n            }\r\n            setShowTop(document.documentElement.scrollTop > 700);\r\n            let scrollTop=document.documentElement.scrollTop;\r\n            let clientHeight=document.documentElement.clientHeight;\r\n            let pageHeight=$page.current.clientHeight;\r\n            if (scrollTop && (clientHeight + scrollTop + 150 >pageHeight)) {\r\n                queryList(nextDate, isMobile);\r\n            }\r\n            console.log(clientHeight + scrollTop,pageHeight)\r\n        },100)\r\n        window.onscroll();\r\n    }, [nextDate, loading]);\r\n\r\n    useEffect(() => {\r\n        const isMobile = checkMode();\r\n        Array.prototype.last = function () {\r\n            return this[this.length - 1];\r\n        }\r\n        axios(`/api/sort`)\r\n            .then(res => {\r\n                setSortInfo(res.data)\r\n            })\r\n        queryList(nextDate, isMobile)\r\n        process.env.NODE_ENV === 'development' && setTimeout(()=>{\r\n            const VConsole = require('vconsole');\r\n            new VConsole();\r\n        })\r\n    }, [])\r\n    return (\r\n        <div className={`index-page ${isMobile && 'mobile-page'}`} ref={$page}>\r\n            <Head></Head>\r\n            <div className=\"img-list\"\r\n                 style={{\r\n                     gridTemplateRows: isMobile ? `repeat(${list.length}, 75vw)` : `repeat(${parseInt(list.length / 10) * 4}, 19vw)`\r\n                 }}>\r\n                {\r\n                    list.map((img) => (\r\n                        <div\r\n                            className=\"img-item\"\r\n                            style={img.style}\r\n                            key={img.date}\r\n                        >\r\n                            <div className=\"cover\">\r\n                                <a className=\"iconfont icon-fangda actionBtn\" href={`/${img.date}`}/>\r\n                                <span className=\"text\">{img.cp}</span>\r\n                            </div>\r\n                            <div className={`date-str size-${img.span}`}>{img.dateStr}</div>\r\n                            <div className=\"img-bg\"\r\n                                 style={{backgroundImage: `url('//cn.bing.com${img.urlbase}_${false ? '768x1280' : '1024x768'}.jpg')`}}/>\r\n                             <div className=\"handleButton\">\r\n                                 <span className={(likeList.includes(img.date)?'icon-like-fill':'icon-xihuan')+' iconfont'} onClick={() => {throttleLikeFun(img.date)}}>\r\n                                     <span className=\"count\">{sortInfo[img.date] && sortInfo[img.date].likeCount || 0}</span>\r\n                                 </span>\r\n                                 <span  onClick={() => {setDownDialogVisible(true);updateImg(img);}} className=\"iconfont icon-download\">\r\n                                    <span className=\"count\">{sortInfo[img.date] && sortInfo[img.date].downloadCount || 0}</span>\r\n                                 </span>\r\n                             </div>\r\n                        </div>\r\n                    ))\r\n                }\r\n            </div>\r\n            {isEmpty && <div className=\"empty-text\">—— 到底啦 ——</div>}\r\n            <div className=\"right-btn\">\r\n                <div className={`to-top iconfont icon-arrow-left ${!showTop && 'hide'}`}\r\n                     onClick={() => window.scrollTo(0, 0)}/>\r\n                <a className=\"iconfont icon-touzi\" href='/random'/>\r\n            </div>\r\n            <DownDialog downloadFun={downloadFun} isMobile={isMobile} visible={downDialogVisible} onHide={() => {setDownDialogVisible(false);updateImg({});}}\r\n                        imgInfo={img}/>\r\n        </div>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}