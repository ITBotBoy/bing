{"ast":null,"code":"const moment = require('moment');\n\nexport default ((req, res) => {\n  let {\n    date = 0,\n    count = 0\n  } = req.query,\n      monthData;\n  const {\n    imgArr\n  } = global; //  28\n\n  if (Number(date)) {\n    date = String(date).slice(6);\n    monthData = imgArr.filter(i => String(i.date).includes(date)).reverse(); //今天距离月初的天数\n    // count=new Date(date.slice(4), date.slice(2), 0).getDate()\n  } else {\n    const now = moment().format('YYYYMM');\n    monthData = imgArr.filter(i => String(i.date).includes(now)).reverse();\n\n    if (monthData.length < 28) {\n      const last = moment().subtract(1, 'month').format('YYYYMM');\n      const lastMonthData = imgArr.filter(i => String(i.date).includes(last)).reverse();\n      console.log(imgArr.length, 'lastMonthData');\n      monthData = monthData.concat(lastMonthData);\n    }\n  } // let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\n  // (startIndex < 0) && (startIndex = imgArr.length-1);\n  // [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\n\n\n  res.json({\n    data: monthData\n  });\n});","map":{"version":3,"sources":["F:/bing/Bing/pages/api/list.js"],"names":["moment","require","req","res","date","count","query","monthData","imgArr","global","Number","String","slice","filter","i","includes","reverse","now","format","length","last","subtract","lastMonthData","console","log","concat","json","data"],"mappings":"AAAA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAD,CAAtB;;AACA,gBAAe,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC3B,MAAI;AAAEC,IAAAA,IAAI,GAAG,CAAT;AAAWC,IAAAA,KAAK,GAAG;AAAnB,MAAyBH,GAAG,CAACI,KAAjC;AAAA,MAAuCC,SAAvC;AACA,QAAM;AAAEC,IAAAA;AAAF,MAAaC,MAAnB,CAF2B,CAG3B;;AACA,MAAGC,MAAM,CAACN,IAAD,CAAT,EAAgB;AACZA,IAAAA,IAAI,GAACO,MAAM,CAACP,IAAD,CAAN,CAAaQ,KAAb,CAAmB,CAAnB,CAAL;AACAL,IAAAA,SAAS,GAACC,MAAM,CAACK,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACV,IAAH,CAAN,CAAeW,QAAf,CAAwBX,IAAxB,CAAjB,EAAgDY,OAAhD,EAAV,CAFY,CAGZ;AACA;AACH,GALD,MAKM;AACF,UAAMC,GAAG,GAAGjB,MAAM,GAAGkB,MAAT,CAAgB,QAAhB,CAAZ;AACAX,IAAAA,SAAS,GAACC,MAAM,CAACK,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACV,IAAH,CAAN,CAAeW,QAAf,CAAwBE,GAAxB,CAAjB,EAA+CD,OAA/C,EAAV;;AACA,QAAGT,SAAS,CAACY,MAAV,GAAiB,EAApB,EAAuB;AACnB,YAAMC,IAAI,GAACpB,MAAM,GAAGqB,QAAT,CAAkB,CAAlB,EAAqB,OAArB,EAA8BH,MAA9B,CAAqC,QAArC,CAAX;AACA,YAAMI,aAAa,GAACd,MAAM,CAACK,MAAP,CAAcC,CAAC,IAAEH,MAAM,CAACG,CAAC,CAACV,IAAH,CAAN,CAAeW,QAAf,CAAwBK,IAAxB,CAAjB,EAAgDJ,OAAhD,EAApB;AACAO,MAAAA,OAAO,CAACC,GAAR,CAAYhB,MAAM,CAACW,MAAnB,EAA0B,eAA1B;AACAZ,MAAAA,SAAS,GAACA,SAAS,CAACkB,MAAV,CAAiBH,aAAjB,CAAV;AACH;AACJ,GAlB0B,CAmBzB;AACA;AACA;;;AACFnB,EAAAA,GAAG,CAACuB,IAAJ,CAAS;AACPC,IAAAA,IAAI,EAAEpB;AADC,GAAT;AAGD,CAzBD","sourcesContent":["const moment = require('moment');\nexport default (req, res) => {\n  let { date = 0,count = 0 } = req.query,monthData;\n  const { imgArr } = global;\n  //  28\n  if(Number(date)){\n      date=String(date).slice(6)\n      monthData=imgArr.filter(i=>String(i.date).includes(date)).reverse()\n      //今天距离月初的天数\n      // count=new Date(date.slice(4), date.slice(2), 0).getDate()\n  }else {\n      const now = moment().format('YYYYMM');\n      monthData=imgArr.filter(i=>String(i.date).includes(now)).reverse()\n      if(monthData.length<28){\n          const last=moment().subtract(1, 'month').format('YYYYMM')\n          const lastMonthData=imgArr.filter(i=>String(i.date).includes(last)).reverse()\n          console.log(imgArr.length,'lastMonthData')\n          monthData=monthData.concat(lastMonthData)\n      }\n  }\n    // let startIndex = imgArr.findIndex(({ date: d }) => date === `${d}`);\n    // (startIndex < 0) && (startIndex = imgArr.length-1);\n    // [...imgArr.slice(Math.max(0, startIndex - (count-1)), startIndex + 1)].reverse()\n  res.json({\n    data: monthData,\n  })\n}\n"]},"metadata":{},"sourceType":"module"}